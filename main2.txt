=== File: src/app/alerts/page.tsx ===
// app/alerts/page.tsx
'use client';

import React, { useState, useEffect } from 'react';
import Link from 'next/link';
import { ArrowLeft, Bell, Send, Globe, AlertCircle } from 'lucide-react';
import MultilingualAlertSystem from '../../components/MultilingualAlertSystem';
import { addAlert, getAlerts, onAlertsChange, deleteAlert } from '../../lib/alertStore';
import type { Language } from '../../lib/translationService';

export default function AlertsPage() {
  const [alertForm, setAlertForm] = useState({
    type: 'other' as string,
    severity: 'moderate' as 'extreme' | 'severe' | 'moderate' | 'minor',
    message: '',
    area: '',
    instructions: '',
    affectedPopulation: ''
  });

  const [previewLanguage, setPreviewLanguage] = useState<Language>('en');
  const [alerts, setAlerts] = useState(getAlerts());
  const [showSuccess, setShowSuccess] = useState(false);

  useEffect(() => {
    // Load alerts
    setAlerts(getAlerts());

    // Subscribe to alert changes
    const unsubscribe = onAlertsChange((updatedAlerts) => {
      setAlerts(updatedAlerts);
    });

    return () => unsubscribe();
  }, []);

  const alertTypes = [
    { value: 'earthquake', label: 'Earthquake', icon: 'ðŸŒ' },
    { value: 'flood', label: 'Flood', icon: 'ðŸŒŠ' },
    { value: 'fire', label: 'Fire', icon: 'ðŸ”¥' },
    { value: 'hurricane', label: 'Hurricane', icon: 'ðŸŒ€' },
    { value: 'tornado', label: 'Tornado', icon: 'ðŸŒªï¸' },
    { value: 'amber', label: 'AMBER Alert', icon: 'ðŸ‘¶' },
    { value: 'silver', label: 'Silver Alert', icon: 'ðŸ‘´' },
    { value: 'other', label: 'Other Emergency', icon: 'âš ï¸' }
  ];

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    
    addAlert({
      type: alertForm.type,
      severity: alertForm.severity,
      message: alertForm.message,
      area: alertForm.area,
      issued: new Date().toISOString(),
      expires: new Date(Date.now() + 3600000).toISOString(),
      agency: 'Emergency Management',
      instructions: alertForm.instructions || undefined,
      affectedPopulation: alertForm.affectedPopulation ? parseInt(alertForm.affectedPopulation) : undefined
    });
    
    // Reset form
    setAlertForm({
      type: 'other',
      severity: 'moderate',
      message: '',
      area: '',
      instructions: '',
      affectedPopulation: ''
    });

    setShowSuccess(true);
    setTimeout(() => setShowSuccess(false), 3000);
  };

  const handleDelete = (alertId: number) => {
    deleteAlert(alertId);
  };

  return (
    <div className="min-h-screen bg-slate-900 text-white p-6">
      <div className="max-w-7xl mx-auto">
        {/* Back Button */}
        <Link 
          href="/dashboard"
          className="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-6 transition-colors"
        >
          <ArrowLeft className="w-4 h-4" />
          Back to Dashboard
        </Link>

        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center gap-3 mb-2">
            <div className="bg-amber-600 p-3 rounded-lg">
              <Bell className="w-8 h-8 text-white" />
            </div>
            <div>
              <h1 className="text-3xl font-bold text-white">Multilingual Alert System</h1>
              <p className="text-slate-400">Create and broadcast emergency alerts in multiple languages</p>
            </div>
          </div>
        </div>

        {/* Language Info Banner */}
        <div className="mb-6 bg-blue-900/30 border border-blue-600 rounded-lg p-4">
          <div className="flex items-start gap-3">
            <Globe className="w-5 h-5 text-blue-400 mt-0.5" />
            <div>
              <h3 className="text-blue-300 font-semibold mb-1">Multilingual Support Enabled</h3>
              <p className="text-blue-200 text-sm">
                All alerts are automatically translated to <strong>Spanish (EspaÃ±ol)</strong> and <strong>French (FranÃ§ais)</strong> 
                to ensure all first responders and community members can understand emergency information.
              </p>
            </div>
          </div>
        </div>

        {/* Success Message */}
        {showSuccess && (
          <div className="mb-6 bg-green-900/30 border border-green-600 rounded-lg p-4">
            <div className="flex items-center gap-2 text-green-400">
              <AlertCircle className="w-5 h-5" />
              <span className="font-semibold">Alert broadcast successfully in all languages!</span>
            </div>
          </div>
        )}

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {/* Alert Creation Form */}
          <div className="bg-slate-800 rounded-xl border border-slate-700 p-6">
            <h2 className="text-xl font-semibold text-white mb-4 flex items-center gap-2">
              <Send className="w-5 h-5 text-amber-400" />
              Create Alert
            </h2>

            <form onSubmit={handleSubmit} className="space-y-4">
              {/* Alert Type */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  Alert Type *
                </label>
                <div className="grid grid-cols-2 gap-2">
                  {alertTypes.map((type) => (
                    <button
                      key={type.value}
                      type="button"
                      onClick={() => setAlertForm({ ...alertForm, type: type.value })}
                      className={`p-3 rounded-lg border-2 transition-all ${
                        alertForm.type === type.value
                          ? 'border-amber-500 bg-amber-600/20'
                          : 'border-slate-600 bg-slate-700 hover:border-slate-500'
                      }`}
                    >
                      <div className="text-2xl mb-1">{type.icon}</div>
                      <div className={`text-xs font-medium ${
                        alertForm.type === type.value ? 'text-white' : 'text-slate-400'
                      }`}>
                        {type.label}
                      </div>
                    </button>
                  ))}
                </div>
              </div>

              {/* Severity */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  Severity Level *
                </label>
                <select
                  value={alertForm.severity}
                  onChange={(e) => setAlertForm({ ...alertForm, severity: e.target.value as any })}
                  className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-amber-500 focus:outline-none"
                >
                  <option value="extreme">Extreme - Life threatening</option>
                  <option value="severe">Severe - Significant threat</option>
                  <option value="moderate">Moderate - Possible threat</option>
                  <option value="minor">Minor - Minimal threat</option>
                </select>
              </div>

              {/* Message */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  Alert Message * (English)
                </label>
                <textarea
                  value={alertForm.message}
                  onChange={(e) => setAlertForm({ ...alertForm, message: e.target.value })}
                  placeholder="Describe the emergency situation..."
                  rows={3}
                  required
                  className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 resize-none focus:ring-2 focus:ring-amber-500 focus:outline-none"
                />
                <p className="mt-1 text-xs text-slate-400">
                  Will be auto-translated to Spanish and French
                </p>
              </div>

              {/* Affected Area */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  Affected Area *
                </label>
                <input
                  type="text"
                  value={alertForm.area}
                  onChange={(e) => setAlertForm({ ...alertForm, area: e.target.value })}
                  placeholder="e.g., Downtown, North District"
                  required
                  className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-amber-500 focus:outline-none"
                />
              </div>

              {/* Instructions */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  Safety Instructions (Optional)
                </label>
                <textarea
                  value={alertForm.instructions}
                  onChange={(e) => setAlertForm({ ...alertForm, instructions: e.target.value })}
                  placeholder="e.g., Seek shelter immediately, Evacuate the area"
                  rows={2}
                  className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 resize-none focus:ring-2 focus:ring-amber-500 focus:outline-none"
                />
              </div>

              {/* Affected Population */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  Affected Population (Optional)
                </label>
                <input
                  type="number"
                  value={alertForm.affectedPopulation}
                  onChange={(e) => setAlertForm({ ...alertForm, affectedPopulation: e.target.value })}
                  placeholder="e.g., 50000"
                  min="0"
                  className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-amber-500 focus:outline-none"
                />
              </div>

              <button
                type="submit"
                className="w-full bg-amber-600 hover:bg-amber-500 text-white font-semibold py-3 rounded-lg transition-colors"
              >
                Broadcast Alert
              </button>
            </form>
          </div>

          {/* Active Alerts Display */}
          <div className="bg-slate-800 rounded-xl border border-slate-700 p-6">
            <h2 className="text-xl font-semibold text-white mb-4 flex items-center gap-2">
              <Bell className="w-5 h-5 text-blue-400" />
              Active Alerts ({alerts.length})
            </h2>
            
            <div className="max-h-[600px] overflow-y-auto pr-2">
              <MultilingualAlertSystem alerts={alerts} onDelete={handleDelete} />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}=== File: src/app/api/auth/login/logout/route.ts ===
// app/api/auth/logout/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { deleteSession, logActivity, validateSession } from '../../../../../lib/auth';

export async function POST(request: NextRequest) {
  try {
    const token = request.cookies.get('session_token')?.value;
    
    if (token) {
      // Get user before deleting session for logging
      const user = validateSession(token);
      
      // Delete session
      deleteSession(token);
      
      // Log logout
      if (user) {
        logActivity(
          user.id,
          'LOGOUT',
          'User logged out',
          request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown'
        );
      }
    }
    
    // Clear session cookie
    const response = NextResponse.json(
      { success: true, message: 'Logged out successfully' },
      { status: 200 }
    );
    
    response.cookies.delete('session_token');
    
    return response;
  } catch (error) {
    console.error('Logout error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}=== File: src/app/api/auth/login/route.ts ===
// app/api/auth/login/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { authenticateUser, createSession, logActivity } from '../../../../lib/auth';
import { seedSampleUsers } from '../../../../lib/db';

// Ensure sample users exist
try {
  seedSampleUsers();
} catch (error) {
  console.error('Error seeding users:', error);
}

export async function POST(request: NextRequest) {
  try {
    const { username, password } = await request.json();
    
    if (!username || !password) {
      return NextResponse.json(
        { error: 'Username and password are required' },
        { status: 400 }
      );
    }
    
    // Authenticate user
    const user = authenticateUser(username, password);
    
    if (!user) {
      // Log failed attempt
      logActivity(
        null,
        'LOGIN_FAILED',
        `Failed login attempt for username: ${username}`,
        request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown'
      );
      
      return NextResponse.json(
        { error: 'Invalid username or password' },
        { status: 401 }
      );
    }
    
    // Create session
    const token = createSession(user.id);
    
    // Log successful login
    logActivity(
      user.id,
      'LOGIN_SUCCESS',
      `User logged in successfully`,
      request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown'
    );
    
    // Set session cookie
    const response = NextResponse.json(
      {
        success: true,
        user: {
          id: user.id,
          username: user.username,
          role: user.role,
          name: user.name,
          email: user.email,
          organization: user.organization,
        },
      },
      { status: 200 }
    );
    
    response.cookies.set('session_token', token, {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'lax',
      maxAge: 60 * 60 * 24 * 7, // 7 days
      path: '/',
    });
    
    return response;
  } catch (error) {
    console.error('Login error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}=== File: src/app/api/auth/login/session/route.ts ===
// app/api/auth/session/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { validateSession } from '../../../../../lib/auth';

export async function GET(request: NextRequest) {
  try {
    const token = request.cookies.get('session_token')?.value;
    
    if (!token) {
      return NextResponse.json(
        { error: 'No session token' },
        { status: 401 }
      );
    }
    
    const user = validateSession(token);
    
    if (!user) {
      return NextResponse.json(
        { error: 'Invalid or expired session' },
        { status: 401 }
      );
    }
    
    return NextResponse.json(
      {
        success: true,
        user: {
          id: user.id,
          username: user.username,
          role: user.role,
          name: user.name,
          email: user.email,
          organization: user.organization,
        },
      },
      { status: 200 }
    );
  } catch (error) {
    console.error('Session validation error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}=== File: src/app/api/drone/analyze/route.ts ===
// src/app/api/drone/analyze/route.ts
// Damage analysis endpoint
import { NextRequest, NextResponse } from 'next/server';

export async function GET(req: NextRequest) {
  const { searchParams } = new URL(req.url);
  const missionId = searchParams.get('missionId') || 'demo-mission';
  
  // Mock damage analysis data
  // In production, this would use actual terrain analysis algorithms
  // and possibly @turf/turf for geospatial calculations
  
  await new Promise(r => setTimeout(r, 1500)); // Simulate analysis time
  
  const damageTypes = ['flood', 'collapse', 'debris', 'fire'];
  const numFeatures = 5 + Math.floor(Math.random() * 5); // 5-10 damage zones
  
  const features = Array.from({ length: numFeatures }, (_, i) => ({
    type: 'Feature',
    id: i,
    geometry: {
      type: 'Point',
      coordinates: [
        -84.3880 + (Math.random() - 0.5) * 0.02, // Longitude
        33.7490 + (Math.random() - 0.5) * 0.02   // Latitude
      ]
    },
    properties: {
      damageType: damageTypes[Math.floor(Math.random() * damageTypes.length)],
      severity: 6 + Math.random() * 4, // 6-10 severity
      slope: 0.3 + Math.random() * 0.4,
      area: Math.floor(Math.random() * 1000) + 100, // Square meters
      confidence: 0.7 + Math.random() * 0.3
    }
  }));
  
  const analysis = {
    type: 'FeatureCollection',
    features,
    metadata: {
      missionId,
      analyzedAt: new Date().toISOString(),
      totalDamageZones: features.length,
      averageSeverity: (features.reduce((sum, f) => sum + f.properties.severity, 0) / features.length).toFixed(2),
      highSeverityCount: features.filter(f => f.properties.severity > 8).length
    }
  };
  
  return NextResponse.json(analysis);
}

export async function POST(req: NextRequest) {
  // Allow POST requests for triggering analysis
  const body = await req.json();
  const missionId = body.missionId || 'demo-mission';
  
  // Simulate analysis
  await new Promise(r => setTimeout(r, 2000));
  
  return NextResponse.json({
    success: true,
    message: 'Analysis complete',
    missionId,
    resultsUrl: `/api/drone/analyze?missionId=${missionId}`
  });
}=== File: src/app/api/drone/generate/route.ts ===
// src/app/api/drone/generate/route.ts
// 3D model generation endpoint (simplified without database)
import { NextRequest, NextResponse } from 'next/server';

export async function POST(req: NextRequest) {
  try {
    const body = await req.json();
    const missionId = body.missionId || 'demo-mission';
    
    // Mock delay (simulating 3D model processing)
    // In production, this would actually generate a 3D model
    await new Promise(r => setTimeout(r, Math.random() * 5000 + 3000));
    
    // Model URL for the generated glTF file
    const modelUrl = `/models/${missionId}/base-terrain.gltf`;
    
    // In production, you would:
    // 1. Process drone images
    // 2. Generate point cloud
    // 3. Create mesh
    // 4. Export as glTF
    // 5. Save to public/models/{missionId}/
    
    // For now, we'll just return the expected model URL
    // The Modal3D component has fallback handling if the file doesn't exist
    
    return NextResponse.json({ 
      status: 'ready', 
      modelUrl,
      missionId,
      generatedAt: new Date().toISOString(),
      accuracy: { rmse: 2.5 },
      message: 'Model generated successfully (mock)'
    });
    
  } catch (err) {
    console.error('Generate error:', err);
    return NextResponse.json({ 
      error: (err as Error).message 
    }, { status: 500 });
  }
}

export async function GET(req: NextRequest) {
  const { searchParams } = new URL(req.url);
  const missionId = searchParams.get('missionId') || 'demo-mission';
  
  // Return status of a mission
  return NextResponse.json({
    missionId,
    status: 'ready',
    modelUrl: `/models/${missionId}/base-terrain.gltf`,
    generatedAt: new Date().toISOString()
  });
}=== File: src/app/api/drone/route.ts ===
// src/app/api/drone/route.ts
// Simplified drone upload endpoint (no database dependencies)
import { NextRequest, NextResponse } from 'next/server';

export async function GET() {
  // Mock upload simulation (2s delay for "drone flight")
  await new Promise(r => setTimeout(r, 2000));
  return NextResponse.json({ 
    message: 'Mock drone upload complete! 5 images processed.',
    success: true,
    count: 5
  });
}

export async function POST(req: NextRequest) {
  try {
    // In production, you would handle actual file uploads here
    // For now, just simulate the upload process
    
    await new Promise(r => setTimeout(r, 2000)); // Simulate processing
    
    const mockProcessedFiles = [
      '/uploads/drone/proc_img1.jpg',
      '/uploads/drone/proc_img2.jpg',
      '/uploads/drone/proc_img3.jpg',
      '/uploads/drone/proc_img4.jpg',
      '/uploads/drone/proc_img5.jpg'
    ];
    
    return NextResponse.json({ 
      success: true, 
      files: mockProcessedFiles, 
      count: mockProcessedFiles.length 
    });
    
  } catch (err) {
    console.error('Upload error:', err);
    return NextResponse.json({ 
      error: (err as Error).message 
    }, { status: 500 });
  }
}=== File: src/app/api/predict/route.ts ===
// src/app/api/predict/route.ts
import { NextRequest, NextResponse } from 'next/server';

interface Incident {
  type: string;
  severity: number;
  population_affected: number;
  ambulances_dispatched: number;
  fire_units_dispatched: number;
  police_units_dispatched: number;
  hospital_admissions: number;
  weather_condition: string;
  response_time_minutes?: number;
}

interface PredictionInput {
  incidentType: string;
  severity: number;
  populationAffected: number;
  weatherCondition?: string;
}

interface PredictionResult {
  predictedAmbulances: number;
  predictedFireUnits: number;
  predictedPoliceUnits: number;
  predictedHospitalAdmissions: number;
  estimatedResponseTime: number;
  estimatedDuration: number;
  confidence: number;
  historicalSimilarIncidents: number;
  recommendations: string[];
}

// Mock historical data (in production, load from database)
const historicalData = {
  incidents: [
    { type: 'flood', severity: 7, population_affected: 500, ambulances_dispatched: 3, fire_units_dispatched: 2, police_units_dispatched: 4, hospital_admissions: 12, weather_condition: 'heavy_rain', response_time_minutes: 8 },
    { type: 'flood', severity: 5, population_affected: 200, ambulances_dispatched: 2, fire_units_dispatched: 1, police_units_dispatched: 2, hospital_admissions: 5, weather_condition: 'clear', response_time_minutes: 6 },
    { type: 'fire', severity: 8, population_affected: 300, ambulances_dispatched: 4, fire_units_dispatched: 5, police_units_dispatched: 3, hospital_admissions: 15, weather_condition: 'windy', response_time_minutes: 7 },
    { type: 'fire', severity: 6, population_affected: 150, ambulances_dispatched: 2, fire_units_dispatched: 3, police_units_dispatched: 2, hospital_admissions: 8, weather_condition: 'clear', response_time_minutes: 5 },
    { type: 'medical_emergency', severity: 9, population_affected: 100, ambulances_dispatched: 5, fire_units_dispatched: 1, police_units_dispatched: 2, hospital_admissions: 20, weather_condition: 'clear', response_time_minutes: 4 },
    { type: 'medical_emergency', severity: 4, population_affected: 50, ambulances_dispatched: 1, fire_units_dispatched: 0, police_units_dispatched: 1, hospital_admissions: 3, weather_condition: 'clear', response_time_minutes: 6 },
  ]
};

// Simple linear regression-based predictor
function predictResourceNeeds(input: PredictionInput): PredictionResult {
  const { incidentType, severity, populationAffected, weatherCondition } = input;

  // Filter historical data for similar incidents
  const similarIncidents = historicalData.incidents.filter((inc: Incident) => {
    return inc.type === incidentType;
  });

  if (similarIncidents.length === 0) {
    // Default fallback if no similar incidents
    return {
      predictedAmbulances: Math.ceil(severity * 1.5),
      predictedFireUnits: Math.ceil(severity * 1.2),
      predictedPoliceUnits: Math.ceil(severity * 1.0),
      predictedHospitalAdmissions: Math.ceil(populationAffected * 0.01),
      estimatedResponseTime: 8,
      estimatedDuration: 4,
      confidence: 0.3,
      historicalSimilarIncidents: 0,
      recommendations: [
        'No historical data for this incident type',
        'Using baseline estimates',
        'Monitor situation closely'
      ]
    };
  }

  // Calculate averages from similar incidents
  const avgAmbulances = similarIncidents.reduce((sum: number, inc: Incident) => sum + inc.ambulances_dispatched, 0) / similarIncidents.length;
  const avgFireUnits = similarIncidents.reduce((sum: number, inc: Incident) => sum + inc.fire_units_dispatched, 0) / similarIncidents.length;
  const avgPoliceUnits = similarIncidents.reduce((sum: number, inc: Incident) => sum + inc.police_units_dispatched, 0) / similarIncidents.length;
  const avgHospitalAdmissions = similarIncidents.reduce((sum: number, inc: Incident) => sum + inc.hospital_admissions, 0) / similarIncidents.length;

  // Adjust based on severity (scale factor)
  const avgSeverity = similarIncidents.reduce((sum: number, inc: Incident) => sum + inc.severity, 0) / similarIncidents.length;
  const severityFactor = severity / avgSeverity;

  // Adjust based on population
  const avgPopulation = similarIncidents.reduce((sum: number, inc: Incident) => sum + inc.population_affected, 0) / similarIncidents.length;
  const populationFactor = populationAffected / avgPopulation;

  // Combined adjustment factor
  const adjustmentFactor = (severityFactor + populationFactor) / 2;

  // Weather impact
  let weatherMultiplier = 1.0;
  if (weatherCondition === 'heavy_rain' || weatherCondition === 'windy') {
    weatherMultiplier = 1.2;
  }

  // Final predictions
  const predictedAmbulances = Math.ceil(avgAmbulances * adjustmentFactor * weatherMultiplier);
  const predictedFireUnits = Math.ceil(avgFireUnits * adjustmentFactor * weatherMultiplier);
  const predictedPoliceUnits = Math.ceil(avgPoliceUnits * adjustmentFactor * weatherMultiplier);
  const predictedHospitalAdmissions = Math.ceil(avgHospitalAdmissions * adjustmentFactor);

  // Estimate response time based on severity
  const estimatedResponseTime = Math.ceil(5 + (severity * 1.5) + (weatherMultiplier - 1) * 5);
  const estimatedDuration = Math.ceil(2 + (severity * 1.5));

  // Confidence score based on sample size
  const confidence = Math.min(0.95, similarIncidents.length / 10);

  // Generate recommendations
  const recommendations: string[] = [];
  
  if (predictedAmbulances >= 5) {
    recommendations.push('âš ï¸ High ambulance demand expected - consider pre-positioning units');
  }
  
  if (severity >= 4) {
    recommendations.push('ðŸš¨ Severe incident - activate emergency operations center');
  }
  
  if (weatherCondition === 'heavy_rain') {
    recommendations.push('ðŸŒ§ï¸ Weather conditions may delay response - factor in extra time');
  }
  
  if (predictedHospitalAdmissions >= 15) {
    recommendations.push('ðŸ¥ Alert hospitals to prepare for mass casualty event');
  }

  if (incidentType === 'flood') {
    recommendations.push('ðŸŒŠ Consider water rescue equipment and boats');
  }

  if (incidentType === 'fire') {
    recommendations.push('ðŸ”¥ Ensure fire suppression resources are adequate');
  }

  return {
    predictedAmbulances,
    predictedFireUnits,
    predictedPoliceUnits,
    predictedHospitalAdmissions,
    estimatedResponseTime,
    estimatedDuration,
    confidence,
    historicalSimilarIncidents: similarIncidents.length,
    recommendations
  };
}

export async function POST(req: NextRequest) {
  try {
    const body = await req.json();
    const { incidentType, severity, populationAffected, weatherCondition } = body;

    if (!incidentType || !severity || !populationAffected) {
      return NextResponse.json(
        { error: 'Missing required fields: incidentType, severity, populationAffected' },
        { status: 400 }
      );
    }

    const prediction = predictResourceNeeds({
      incidentType,
      severity: Number(severity),
      populationAffected: Number(populationAffected),
      weatherCondition
    });

    return NextResponse.json({
      success: true,
      prediction,
      input: body,
      timestamp: new Date().toISOString()
    });

  } catch (error) {
    console.error('Prediction error:', error);
    return NextResponse.json(
      { error: 'Failed to generate prediction' },
      { status: 500 }
    );
  }
}

export async function GET(req: NextRequest) {
  // Return historical data statistics
  const stats = {
    totalIncidents: historicalData.incidents.length,
    incidentTypes: {
      flood: historicalData.incidents.filter((i: Incident) => i.type === 'flood').length,
      fire: historicalData.incidents.filter((i: Incident) => i.type === 'fire').length,
      medical_emergency: historicalData.incidents.filter((i: Incident) => i.type === 'medical_emergency').length
    },
    averageResponseTime: (historicalData.incidents.reduce((sum: number, i: Incident) => sum + (i.response_time_minutes || 0), 0) / historicalData.incidents.length).toFixed(1),
    totalResourcesDeployed: {
      ambulances: historicalData.incidents.reduce((sum: number, i: Incident) => sum + i.ambulances_dispatched, 0),
      fireUnits: historicalData.incidents.reduce((sum: number, i: Incident) => sum + i.fire_units_dispatched, 0),
      policeUnits: historicalData.incidents.reduce((sum: number, i: Incident) => sum + i.police_units_dispatched, 0)
    }
  };

  return NextResponse.json({
    success: true,
    stats,
    modelInfo: {
      type: 'Rule-based regression with historical averaging',
      version: '1.0',
      lastUpdated: '2025-01-15'
    }
  });
}=== File: src/app/api/responder/route.ts ===
import { NextRequest, NextResponse } from 'next/server';
import fs from 'fs-extra';
import path from 'path';
import { io } from '../socket/route';

const dataPath = path.join(process.cwd(), 'data/responders.json');  // Store in data folder

// Ensure data folder exists
const dataDir = path.dirname(dataPath);
if (!fs.existsSync(dataDir)) {
  fs.mkdirSync(dataDir);
}

// Load data
function loadData(): Array<{
  id: string;
  status: 'standby' | 'active';
  location: { lat: number; lng: number } | null;
  updatedAt: string;
}> {
  if (fs.existsSync(dataPath)) {
    return fs.readJsonSync(dataPath);
  }
  return [
    { id: 'FR-101', status: 'standby', location: null, updatedAt: new Date().toISOString() },
    { id: 'FR-102', status: 'active', location: null, updatedAt: new Date().toISOString() },
    { id: 'FR-103', status: 'standby', location: null, updatedAt: new Date().toISOString() },
    { id: 'FR-104', status: 'active', location: null, updatedAt: new Date().toISOString() },
  ];
}

// Save data
function saveData(data: any[]) {
  fs.writeJsonSync(dataPath, data, { spaces: 2 });
}

export async function GET() {
  return NextResponse.json(loadData());
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { id, status, location } = body;

    if (!id) {
      return NextResponse.json({ error: 'ID required' }, { status: 400 });
    }

    let data = loadData();
    const index = data.findIndex(r => r.id === id);
    const update = {
      id,
      status: status as 'standby' | 'active',
      location: location || null,
      updatedAt: new Date().toISOString(),
    };

    if (index > -1) {
      data[index] = update;
    } else {
      data.push(update);
    }

    saveData(data);  // Persist to file
    // Emit to Socket.io
    if (io) {
        io.emit('responderUpdate', update);  // Fixed: use io directly
    }

    console.log('Updated responder:', update);

    return NextResponse.json({ success: true, data: update });
    } catch (error) {
    return NextResponse.json({ error: 'Invalid data' }, { status: 400 });
    }
}=== File: src/app/api/socket/route.ts ===
import { NextRequest } from 'next/server';
import { Server } from 'socket.io';
import { createServer } from 'http';

// Global Socket.io server (prototype; use in production with proper setup)
let io: Server | null = null;

export async function GET(request: NextRequest) {
  if (!io) {
    const httpServer = createServer();
    io = new Server(httpServer, { cors: { origin: '*' } });
    httpServer.listen(4000);  // Separate port for Socket.io

    io.on('connection', (socket) => {
      console.log('Client connected:', socket.id);
      socket.on('disconnect', () => console.log('Client disconnected:', socket.id));
    });
  }

  return new Response('Socket.io ready', { status: 200 });
}

// Export for API use
export { io };=== File: src/app/dashboard/page.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import ProtectedRoute from '../../components/ProtectedRoute';
import Navigation from '../../components/Navigation';
import { useAuth } from '../../lib/AuthContext';
import Link from 'next/link';
import {
  Activity,
  Ambulance,
  Building2,
  Users,
  AlertCircle,
  TrendingUp,
  MapPin,
  Clock,
  ArrowRight,
  Bell,
  Radio,
} from 'lucide-react';
import AlertSystem from '../../components/AlertSystem';
import { getHospitalData, onHospitalDataChange } from '../../lib/hospitalDataStore';
import { getResourceRequests, onRequestDataChange } from '../../lib/resourceRequestStore';

export default function DashboardPage() {
  const { user } = useAuth();
  const [hospitals, setHospitals] = useState(getHospitalData());
  const [resourceRequests, setResourceRequests] = useState(getResourceRequests());

  useEffect(() => {
    const unsubscribeHospitals = onHospitalDataChange(() => {
      setHospitals(getHospitalData());
    });
    const unsubscribeRequests = onRequestDataChange((updated) => {
      setResourceRequests(updated);
    });
    return () => {
      unsubscribeHospitals();
      unsubscribeRequests();
    };
  }, []);

  // Calculate key metrics
  const totalBeds = hospitals.reduce((sum, h) => sum + (h.availableBeds || 0), 0);
  const totalICU = hospitals.reduce((sum, h) => sum + (h.availableICU || 0), 0);
  const totalVentilators = hospitals.reduce((sum, h) => sum + (h.ventilators || 0), 0);
  const criticalRequests = resourceRequests.filter((r) => r.priority === 'Critical').length;

  const [ambulances] = useState([
    { id: 'AMB-001', status: 'available', location: 'Station 1' },
    { id: 'AMB-002', status: 'en-route', location: 'Main St & 5th Ave' },
    { id: 'AMB-003', status: 'on-scene', location: 'City Park' },
    { id: 'AMB-004', status: 'available', location: 'Station 2' },
  ]);

  const availableAmbulances = ambulances.filter((a) => a.status === 'available').length;
  const activeAmbulances = ambulances.filter((a) => a.status !== 'available').length;

  const [recentActivity] = useState([
    { id: 1, time: '2 min ago', event: 'Ambulance AMB-002 dispatched', type: 'dispatch', icon: Ambulance },
    { id: 2, time: '5 min ago', event: 'Hospital capacity updated', type: 'update', icon: Building2 },
    { id: 3, time: '8 min ago', event: 'First responder Unit Alpha responded', type: 'response', icon: Users },
    { id: 4, time: '12 min ago', event: 'New alert issued by dispatch', type: 'alert', icon: AlertCircle },
  ]);

  const quickActions = [
    {
      title: 'View Full Map',
      description: 'See all responders and incidents',
      href: '/map',
      icon: MapPin,
      color: 'blue',
      show: user?.role === 'admin' || user?.role === 'dispatcher' || user?.role === 'first_responder',
    },
    {
      title: 'Manage Hospitals',
      description: 'Update hospital resources',
      href: '/hospital-resources',
      icon: Building2,
      color: 'emerald',
      show: user?.role === 'admin' || user?.role === 'hospital_worker' || user?.role === 'dispatcher',
    },
    {
      title: 'Review Requests',
      description: 'Approve resource requests',
      href: '/resource-review',
      icon: AlertCircle,
      color: 'purple',
      show: user?.role === 'admin' || user?.role === 'dispatcher',
    },
    {
      title: 'Send Alerts',
      description: 'Issue government alerts',
      href: '/alerts',
      icon: Bell,
      color: 'red',
      show: user?.role === 'admin' || user?.role === 'dispatcher',
    },
  ].filter((action) => action.show);

  return (
    <ProtectedRoute requiredPermissions={['canAccessDashboard']}>
      <div className="min-h-screen bg-slate-900">
        <Navigation />

        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          {/* Welcome Section */}
          <div className="mb-8">
            <h1 className="text-3xl font-bold text-white mb-2">
              Welcome back, {user?.name || 'User'}
            </h1>
            <p className="text-slate-400">Real-time crisis management and coordination</p>
          </div>

          {/* Key Metrics */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div className="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-6 shadow-lg">
              <div className="flex items-center justify-between mb-4">
                <Ambulance className="w-8 h-8 text-white" />
                <TrendingUp className="w-5 h-5 text-blue-200" />
              </div>
              <div className="text-3xl font-bold text-white mb-1">{availableAmbulances}</div>
              <p className="text-blue-100 text-sm">Available Ambulances</p>
              <p className="text-blue-200 text-xs mt-2">{activeAmbulances} currently active</p>
            </div>

            <div className="bg-gradient-to-br from-emerald-600 to-emerald-700 rounded-xl p-6 shadow-lg">
              <div className="flex items-center justify-between mb-4">
                <Building2 className="w-8 h-8 text-white" />
                <TrendingUp className="w-5 h-5 text-emerald-200" />
              </div>
              <div className="text-3xl font-bold text-white mb-1">{totalBeds}</div>
              <p className="text-emerald-100 text-sm">Available Hospital Beds</p>
              <p className="text-emerald-200 text-xs mt-2">{totalICU} ICU beds available</p>
            </div>

            <div className="bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl p-6 shadow-lg">
              <div className="flex items-center justify-between mb-4">
                <Activity className="w-8 h-8 text-white" />
                <TrendingUp className="w-5 h-5 text-purple-200" />
              </div>
              <div className="text-3xl font-bold text-white mb-1">{totalVentilators}</div>
              <p className="text-purple-100 text-sm">Ventilators Available</p>
              <p className="text-purple-200 text-xs mt-2">Across {hospitals.length} hospitals</p>
            </div>

            <div className="bg-gradient-to-br from-red-600 to-red-700 rounded-xl p-6 shadow-lg">
              <div className="flex items-center justify-between mb-4">
                <AlertCircle className="w-8 h-8 text-white" />
                <Bell className="w-5 h-5 text-red-200 animate-pulse" />
              </div>
              <div className="text-3xl font-bold text-white mb-1">{criticalRequests}</div>
              <p className="text-red-100 text-sm">Critical Requests</p>
              <p className="text-red-200 text-xs mt-2">{resourceRequests.length} total pending</p>
            </div>
          </div>

          {/* Government Alerts - Compact View */}
          <div className="mb-8">
            <AlertSystem />
          </div>

          {/* Two Column Layout */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            {/* Quick Actions */}
            <div className="bg-slate-800 rounded-xl p-6 shadow-xl border border-slate-700">
              <h2 className="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <Activity className="w-5 h-5 text-blue-400" />
                Quick Actions
              </h2>
              <div className="grid grid-cols-1 gap-3">
                {quickActions.map((action) => {
                  const Icon = action.icon;
                  return (
                    <Link
                      key={action.title}
                      href={action.href}
                      className={`bg-slate-700/50 hover:bg-slate-700 border border-${action.color}-600/30 rounded-lg p-4 transition-all group`}
                    >
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className={`bg-${action.color}-600 p-2 rounded-lg`}>
                            <Icon className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <h3 className="font-semibold text-white">{action.title}</h3>
                            <p className="text-sm text-slate-400">{action.description}</p>
                          </div>
                        </div>
                        <ArrowRight className="w-5 h-5 text-slate-500 group-hover:text-white transition-colors" />
                      </div>
                    </Link>
                  );
                })}
              </div>
            </div>

            {/* Recent Activity */}
            <div className="bg-slate-800 rounded-xl p-6 shadow-xl border border-slate-700">
              <h2 className="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <Clock className="w-5 h-5 text-amber-400" />
                Recent Activity
              </h2>
              <div className="space-y-3">
                {recentActivity.map((activity) => {
                  const Icon = activity.icon;
                  return (
                    <div
                      key={activity.id}
                      className="bg-slate-700/50 rounded-lg p-3 flex items-start gap-3"
                    >
                      <div className="bg-slate-600 p-2 rounded-lg">
                        <Icon className="w-4 h-4 text-slate-300" />
                      </div>
                      <div className="flex-1">
                        <p className="text-white text-sm font-medium">{activity.event}</p>
                        <p className="text-slate-400 text-xs mt-1">{activity.time}</p>
                      </div>
                    </div>
                  );
                })}
              </div>
              <Link
                href="/activity-log"
                className="mt-4 block text-center text-blue-400 hover:text-blue-300 text-sm font-medium"
              >
                View full activity log â†’
              </Link>
            </div>
          </div>

          {/* Critical Alerts Section */}
          {resourceRequests.length > 0 && (
            <div className="bg-red-900/30 border-l-4 border-red-600 rounded-lg shadow-lg p-6">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <AlertCircle className="w-6 h-6 text-red-400" />
                  <div>
                    <h3 className="text-lg font-semibold text-red-100">
                      Pending Resource Requests
                    </h3>
                    <p className="text-red-300 text-sm">Requires immediate attention</p>
                  </div>
                </div>
                <Link
                  href="/resource-review"
                  className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
                >
                  Review All â†’
                </Link>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                {resourceRequests.slice(0, 4).map((req) => (
                  <div
                    key={req.id}
                    className="bg-slate-800/50 rounded-lg p-3 flex justify-between items-center"
                  >
                    <div>
                      <span className="font-semibold text-white">{req.hospitalName}</span>
                      <span className="text-slate-400 text-sm ml-2">
                        needs {req.quantity} {req.resourceType}
                      </span>
                      <span
                        className={`ml-2 px-2 py-0.5 rounded text-xs font-bold ${
                          req.priority === 'Critical'
                            ? 'bg-red-600'
                            : req.priority === 'High'
                            ? 'bg-orange-600'
                            : 'bg-blue-600'
                        } text-white`}
                      >
                        {req.priority}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </ProtectedRoute>
  );
}=== File: src/app/hospital-resources/page.tsx ===
// app/hospitals/page.tsx
'use client';

import React, { useState } from 'react';
import Link from 'next/link';
import { ArrowLeft, Building2, Activity } from 'lucide-react';
import HospitalResourcePanel from '../../components/HospitalResourcePanel';
import HospitalResourceForm from '../../components/HospitalResourceForm';

export default function HospitalsPage() {
  const [activeTab, setActiveTab] = useState<'view' | 'manage'>('view');

  return (
    <div className="min-h-screen bg-slate-900 text-white p-6">
      <div className="max-w-7xl mx-auto">
        {/* Back Button */}
        <Link 
          href="/dashboard"
          className="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-6 transition-colors"
        >
          <ArrowLeft className="w-4 h-4" />
          Back to Dashboard
        </Link>

        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center gap-3 mb-2">
            <div className="bg-blue-600 p-3 rounded-lg">
              <Building2 className="w-8 h-8 text-white" />
            </div>
            <div>
              <h1 className="text-3xl font-bold text-white">Hospital Resource Management</h1>
              <p className="text-slate-400">Track and manage hospital bed availability and resources</p>
            </div>
          </div>
        </div>

        {/* Tab Navigation */}
        <div className="mb-6 bg-slate-800 rounded-lg border border-slate-700 p-1 inline-flex">
          <button
            onClick={() => setActiveTab('view')}
            className={`px-6 py-2 rounded-md transition-all ${
              activeTab === 'view'
                ? 'bg-blue-600 text-white'
                : 'text-slate-400 hover:text-white'
            }`}
          >
            <div className="flex items-center gap-2">
              <Activity className="w-4 h-4" />
              View Resources
            </div>
          </button>
          <button
            onClick={() => setActiveTab('manage')}
            className={`px-6 py-2 rounded-md transition-all ${
              activeTab === 'manage'
                ? 'bg-emerald-600 text-white'
                : 'text-slate-400 hover:text-white'
            }`}
          >
            <div className="flex items-center gap-2">
              <Building2 className="w-4 h-4" />
              Manage Hospitals
            </div>
          </button>
        </div>

        {/* Content Area */}
        {activeTab === 'view' ? (
          <div>
            <div className="mb-4 bg-blue-900/30 border border-blue-600 rounded-lg p-4">
              <h3 className="text-blue-300 font-semibold mb-1">Real-Time Resource Tracking</h3>
              <p className="text-blue-200 text-sm">
                Monitor hospital capacity in real-time. Data updates automatically as resources are allocated or released.
              </p>
            </div>
            <HospitalResourcePanel />
          </div>
        ) : (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <HospitalResourceForm />
            </div>
            <div>
              <div className="bg-slate-800 rounded-xl border border-slate-700 p-6">
                <h2 className="text-xl font-semibold text-white mb-4">Instructions</h2>
                <div className="space-y-4 text-slate-300">
                  <div>
                    <h3 className="font-semibold text-white mb-2">Adding a New Hospital</h3>
                    <p className="text-sm">
                      Fill out all required fields and click "Save Hospital Data". The hospital will be added to the system immediately.
                    </p>
                  </div>
                  
                  <div>
                    <h3 className="font-semibold text-white mb-2">Updating Existing Hospital</h3>
                    <p className="text-sm">
                      Enter the exact name of an existing hospital to update its data. All fields will be updated with the new values.
                    </p>
                  </div>
                  
                  <div>
                    <h3 className="font-semibold text-white mb-2">Resource Types</h3>
                    <ul className="text-sm space-y-2 ml-4">
                      <li className="flex items-start gap-2">
                        <span className="text-blue-400">â€¢</span>
                        <span><strong>Total Beds:</strong> Maximum capacity of general hospital beds</span>
                      </li>
                      <li className="flex items-start gap-2">
                        <span className="text-blue-400">â€¢</span>
                        <span><strong>Available Beds:</strong> Currently unoccupied general beds</span>
                      </li>
                      <li className="flex items-start gap-2">
                        <span className="text-blue-400">â€¢</span>
                        <span><strong>ICU Beds:</strong> Intensive care unit beds available</span>
                      </li>
                      <li className="flex items-start gap-2">
                        <span className="text-blue-400">â€¢</span>
                        <span><strong>Ventilators:</strong> Available ventilation equipment</span>
                      </li>
                    </ul>
                  </div>

                  <div className="mt-6 bg-yellow-900/30 border border-yellow-600 rounded-lg p-4">
                    <h3 className="text-yellow-300 font-semibold mb-2">âš ï¸ Important</h3>
                    <p className="text-yellow-200 text-sm">
                      Data is stored in your browser's local storage. Updates are reflected immediately across all components and tabs.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}=== File: src/app/layout.tsx ===
import type { Metadata } from "next";
import { Inter } from 'next/font/google';
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { AuthProvider } from "src/lib/AuthContext";

const inter = Inter({ subsets: ['latin'] });

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: 'Crisis Management Dashboard',
  description: 'Real-time coordination and monitoring system',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        <AuthProvider>
          {children}
        </AuthProvider>
      </body>
    </html>
  );
}=== File: src/app/login/page.tsx ===
// app/login/page.tsx
'use client';

import React, { useState, useEffect } from 'react';
import { useAuth } from '../../lib/AuthContext';
import { useRouter } from 'next/navigation';
import { Shield, AlertCircle, Eye, EyeOff, User, Lock } from 'lucide-react';

export default function LoginPage() {
  const { user, login, loading } = useAuth();
  const router = useRouter();
  const [formData, setFormData] = useState({
    username: '',
    password: '',
  });
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [showCredentials, setShowCredentials] = useState(false);

  // Redirect if already logged in
  useEffect(() => {
    if (!loading && user) {
      router.push('/dashboard');
    }
  }, [user, loading, router]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);

    try {
      await login(formData.username, formData.password);
    } catch (err: any) {
      setError(err.message || 'Invalid username or password');
    } finally {
      setIsLoading(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData((prev) => ({
      ...prev,
      [e.target.name]: e.target.value,
    }));
  };

  const quickLogin = (username: string, password: string) => {
    setFormData({ username, password });
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center">
        <div className="text-white text-xl">Loading...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4">
      <div className="max-w-md w-full space-y-6">
        {/* Header */}
        <div className="text-center">
          <div className="flex justify-center mb-4">
            <div className="bg-blue-600 p-4 rounded-full">
              <Shield className="w-12 h-12 text-white" />
            </div>
          </div>
          <h1 className="text-4xl font-bold text-white mb-2">Crisis Management</h1>
          <p className="text-slate-300">Real-time Coordination System</p>
        </div>

        {/* Login Form */}
        <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-slate-700">
          <form onSubmit={handleSubmit} className="space-y-6">
            {/* Error Message */}
            {error && (
              <div className="bg-red-900/50 border border-red-600 rounded-lg p-3 flex items-center gap-2 text-red-200">
                <AlertCircle className="w-5 h-5 flex-shrink-0" />
                <span className="text-sm">{error}</span>
              </div>
            )}

            {/* Username Field */}
            <div>
              <label htmlFor="username" className="block text-sm font-medium text-slate-300 mb-2">
                Username
              </label>
              <div className="relative">
                <User className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input
                  id="username"
                  name="username"
                  type="text"
                  value={formData.username}
                  onChange={handleChange}
                  className="w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="Enter your username"
                  required
                  autoComplete="username"
                />
              </div>
            </div>

            {/* Password Field */}
            <div>
              <label htmlFor="password" className="block text-sm font-medium text-slate-300 mb-2">
                Password
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input
                  id="password"
                  name="password"
                  type={showPassword ? 'text' : 'password'}
                  value={formData.password}
                  onChange={handleChange}
                  className="w-full pl-10 pr-12 py-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="Enter your password"
                  required
                  autoComplete="current-password"
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-300"
                >
                  {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                </button>
              </div>
            </div>

            {/* Submit Button */}
            <button
              type="submit"
              disabled={isLoading}
              className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 text-white font-semibold py-3 rounded-lg transition-colors flex items-center justify-center gap-2"
            >
              {isLoading ? (
                <>
                  <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                  Logging in...
                </>
              ) : (
                <>
                  <Shield className="w-5 h-5" />
                  Sign In
                </>
              )}
            </button>
          </form>
        </div>

        {/* Sample Credentials */}
        <div className="bg-slate-800/50 backdrop-blur-lg rounded-2xl shadow-xl p-6 border border-slate-700">
          <button
            onClick={() => setShowCredentials(!showCredentials)}
            className="w-full flex items-center justify-between text-slate-300 hover:text-white transition-colors"
          >
            <span className="font-semibold">Sample Login Credentials</span>
            <span className="text-sm">{showCredentials ? 'â–¼' : 'â–¶'}</span>
          </button>
          
          {showCredentials && (
            <div className="mt-4 space-y-3">
              {[
                { role: 'Administrator', username: 'admin', password: 'admin123', color: 'red' },
                { role: 'Dispatcher', username: 'dispatcher1', password: 'dispatch123', color: 'yellow' },
                { role: 'Hospital Worker', username: 'hospital1', password: 'hospital123', color: 'emerald' },
                { role: 'First Responder', username: 'responder1', password: 'respond123', color: 'purple' },
                { role: 'General User', username: 'user1', password: 'user123', color: 'blue' },
              ].map((cred) => (
                <button
                  key={cred.username}
                  onClick={() => quickLogin(cred.username, cred.password)}
                  className={`w-full text-left bg-slate-700/50 hover:bg-slate-700 border border-${cred.color}-600/30 rounded-lg p-3 transition-colors`}
                >
                  <div className="flex items-center justify-between mb-1">
                    <span className={`text-${cred.color}-400 font-semibold text-sm`}>{cred.role}</span>
                    <span className="text-xs text-slate-500">Click to use</span>
                  </div>
                  <div className="text-xs text-slate-400 font-mono">
                    {cred.username} / {cred.password}
                  </div>
                </button>
              ))}
            </div>
          )}
        </div>

        {/* Footer */}
        <p className="text-center text-slate-500 text-sm">
          Â© 2025 Crisis Management System. All rights reserved.
        </p>
      </div>
    </div>
  );
}=== File: src/app/map/page.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import ProtectedRoute from '../../components/ProtectedRoute';
import Navigation from '../../components/Navigation';
import dynamic from 'next/dynamic';
import { MapPin, Users, Activity, Search, Camera, Box, Loader2, Layers } from 'lucide-react';
import StatusBadge from '../../components/StatusBadge';

// Dynamically import map and modal components
const ResponderMap = dynamic(() => import('../../components/ResponderMap'), { ssr: false });
const Modal3D = dynamic(() => import('../../components/Modal3D'), { ssr: false });
const GalleryModal = dynamic(() => import('../../components/GalleryModal'), { ssr: false });

export default function MapPage() {
  const [firstResponders, setFirstResponders] = useState([
    { id: 'FR-101', name: 'Unit Alpha', type: 'Fire', status: 'standby', location: 'Downtown', coords: { lat: 33.7490, lng: -84.3880 } },
    { id: 'FR-102', name: 'Unit Bravo', type: 'Police', status: 'active', location: 'North District', coords: { lat: 33.8958, lng: -84.3014 } },
    { id: 'FR-103', name: 'Unit Charlie', type: 'Fire', status: 'standby', location: 'Station 3', coords: { lat: 33.6407, lng: -84.4277 } },
    { id: 'FR-104', name: 'Unit Delta', type: 'Police', status: 'active', location: 'Highway 5', coords: { lat: 33.7550, lng: -84.4000 } },
  ]);

  const [filterType, setFilterType] = useState<'all' | 'Fire' | 'Police'>('all');
  const [filterStatus, setFilterStatus] = useState<'all' | 'active' | 'standby'>('all');
  const [searchQuery, setSearchQuery] = useState('');

  // Drone 3D Visualization States
  const [droneStatus, setDroneStatus] = useState<'idle' | 'uploading' | 'generating' | 'analyzing' | 'ready'>('idle');
  const [damageAnalysis, setDamageAnalysis] = useState<any>(null);
  const [modelUrl, setModelUrl] = useState<string>('');
  const [show3DModal, setShow3DModal] = useState(false);
  
  // NEW: Damage overlay toggle
  const [showDamageOverlays, setShowDamageOverlays] = useState(false);
  
  // NEW: Image gallery state
  const [showImageGallery, setShowImageGallery] = useState(false);

  // Load responder statuses from localStorage
  useEffect(() => {
    if (typeof window !== 'undefined') {
      const loadedResponders = firstResponders.map(r => ({
        ...r,
        status: (localStorage.getItem(`responder_${r.id.toLowerCase()}_status`) as 'active' | 'standby') || r.status
      }));
      setFirstResponders(loadedResponders);
    }
  }, []);

  // Auto-update on storage change
  useEffect(() => {
    const handleUpdate = () => {
      setFirstResponders(prev => prev.map(r => ({
        ...r,
        status: (localStorage.getItem(`responder_${r.id.toLowerCase()}_status`) as 'active' | 'standby') || r.status
      })));
    };

    if (typeof window !== 'undefined') {
      window.addEventListener('storage', handleUpdate);
      window.addEventListener('focus', handleUpdate);

      return () => {
        window.removeEventListener('storage', handleUpdate);
        window.removeEventListener('focus', handleUpdate);
      };
    }
  }, []);

  // Filter responders
  const filteredResponders = firstResponders.filter(r => {
    const typeMatch = filterType === 'all' || r.type === filterType;
    const statusMatch = filterStatus === 'all' || r.status === filterStatus;
    const searchMatch = searchQuery === '' || 
      r.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      r.id.toLowerCase().includes(searchQuery.toLowerCase()) ||
      r.location.toLowerCase().includes(searchQuery.toLowerCase());
    return typeMatch && statusMatch && searchMatch;
  });

  const activeCount = firstResponders.filter(r => r.status === 'active').length;
  const standbyCount = firstResponders.filter(r => r.status === 'standby').length;

  // Drone simulation function
  const simulateDroneAnalysis = async () => {
    const missionId = 'demo-mission';
    
    // Step 1: Upload drone images
    setDroneStatus('uploading');
    await new Promise(r => setTimeout(r, 2000));
    
    // Step 2: Generate 3D model
    setDroneStatus('generating');
    await new Promise(r => setTimeout(r, 3000));
    const generatedModelUrl = `/models/${missionId}/base-terrain.gltf`;
    setModelUrl(generatedModelUrl);
    
    // Step 3: Analyze damage
    setDroneStatus('analyzing');
    await new Promise(r => setTimeout(r, 2000));
    
    // Mock damage analysis data with GeoJSON coordinates
    const mockAnalysis = {
      type: 'FeatureCollection',
      features: [
        { 
          id: 0,
          geometry: { type: 'Point', coordinates: [-84.3880, 33.7490] },
          properties: { damageType: 'flood', severity: 8.5, slope: 0.45, area: 523, confidence: 0.87 }
        },
        { 
          id: 1,
          geometry: { type: 'Point', coordinates: [-84.3920, 33.7520] },
          properties: { damageType: 'collapse', severity: 9.2, slope: 0.62, area: 780, confidence: 0.92 }
        },
        { 
          id: 2,
          geometry: { type: 'Point', coordinates: [-84.3850, 33.7510] },
          properties: { damageType: 'debris', severity: 7.8, slope: 0.38, area: 345, confidence: 0.81 }
        },
        { 
          id: 3,
          geometry: { type: 'Point', coordinates: [-84.3900, 33.7480] },
          properties: { damageType: 'flood', severity: 8.9, slope: 0.51, area: 612, confidence: 0.89 }
        },
        { 
          id: 4,
          geometry: { type: 'Point', coordinates: [-84.3870, 33.7530] },
          properties: { damageType: 'fire', severity: 9.5, slope: 0.68, area: 890, confidence: 0.94 }
        },
      ]
    };
    setDamageAnalysis(mockAnalysis);
    
    // Step 4: Ready
    setDroneStatus('ready');
    
    // Auto-enable overlays when analysis is ready
    setShowDamageOverlays(true);
    
    // Auto-open 3D modal
    setTimeout(() => setShow3DModal(true), 500);
  };

  // Get status message for drone panel
  const getDroneStatusMessage = () => {
    switch(droneStatus) {
      case 'idle': return 'Ready to scan';
      case 'uploading': return 'Uploading drone imagery...';
      case 'generating': return 'Generating 3D terrain model...';
      case 'analyzing': return 'Analyzing damage zones...';
      case 'ready': return '3D model ready!';
      default: return 'Unknown status';
    }
  };

  return (
    <ProtectedRoute requiredPermissions={['canViewMap']}>
      <div className="min-h-screen bg-slate-900">
        <Navigation />

        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          {/* Header */}
          <div className="mb-6">
            <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
              <MapPin className="w-8 h-8 text-blue-500" />
              Live Map View with 3D Terrain
            </h1>
            <p className="text-slate-400">Real-time first responder locations and drone-generated 3D damage assessment</p>
          </div>

          {/* Stats Cards */}
          <div className="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6">
            <div className="bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-6 shadow-lg">
              <div className="flex items-center justify-between mb-3">
                <Users className="w-8 h-8 text-white" />
                <Activity className="w-5 h-5 text-blue-200" />
              </div>
              <div className="text-3xl font-bold text-white mb-1">{firstResponders.length}</div>
              <p className="text-blue-100 text-sm">Total Responders</p>
            </div>

            <div className="bg-gradient-to-br from-green-600 to-green-700 rounded-xl p-6 shadow-lg">
              <div className="flex items-center justify-between mb-3">
                <Users className="w-8 h-8 text-white" />
                <div className="bg-green-500 w-3 h-3 rounded-full animate-pulse"></div>
              </div>
              <div className="text-3xl font-bold text-white mb-1">{activeCount}</div>
              <p className="text-green-100 text-sm">Active Units</p>
            </div>

            <div className="bg-gradient-to-br from-yellow-600 to-yellow-700 rounded-xl p-6 shadow-lg">
              <div className="flex items-center justify-between mb-3">
                <Users className="w-8 h-8 text-white" />
                <div className="bg-yellow-500 w-3 h-3 rounded-full"></div>
              </div>
              <div className="text-3xl font-bold text-white mb-1">{standbyCount}</div>
              <p className="text-yellow-100 text-sm">Standby Units</p>
            </div>
          </div>

          {/* Drone 3D Control Panel */}
          <div className="bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl p-6 shadow-lg mb-6 border border-purple-500 relative z-10">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="bg-purple-500 p-3 rounded-lg">
                  {droneStatus === 'ready' ? (
                    <Box className="w-6 h-6 text-white" />
                  ) : droneStatus !== 'idle' ? (
                    <Loader2 className="w-6 h-6 text-white animate-spin" />
                  ) : (
                    <Camera className="w-6 h-6 text-white" />
                  )}
                </div>
                <div>
                  <h3 className="text-lg font-semibold text-white">Drone 3D Terrain Analysis</h3>
                  <p className="text-purple-100 text-sm">{getDroneStatusMessage()}</p>
                </div>
              </div>
              <div className="flex gap-3">
                {droneStatus === 'idle' && (
                  <button
                    onClick={simulateDroneAnalysis}
                    className="px-6 py-3 bg-white text-purple-700 rounded-lg font-semibold hover:bg-purple-50 transition-colors flex items-center gap-2"
                  >
                    <Camera className="w-5 h-5" />
                    Start Drone Scan
                  </button>
                )}
                {droneStatus === 'ready' && (
                  <>
                    <button
                      onClick={() => setShow3DModal(true)}
                      className="px-6 py-3 bg-white text-purple-700 rounded-lg font-semibold hover:bg-purple-50 transition-colors flex items-center gap-2"
                    >
                      <Box className="w-5 h-5" />
                      View 3D Model
                    </button>
                    <button
                      onClick={() => setShowImageGallery(true)}
                      className="px-6 py-3 bg-white text-purple-700 rounded-lg font-semibold hover:bg-purple-50 transition-colors flex items-center gap-2"
                    >
                      <Camera className="w-5 h-5" />
                      View Images
                    </button>
                    <button
                      onClick={() => setShowDamageOverlays(!showDamageOverlays)}
                      className={`px-6 py-3 rounded-lg font-semibold transition-colors flex items-center gap-2 ${
                        showDamageOverlays 
                          ? 'bg-white text-purple-700 hover:bg-purple-50' 
                          : 'bg-purple-800 text-white hover:bg-purple-900'
                      }`}
                    >
                      <Layers className="w-5 h-5" />
                      {showDamageOverlays ? 'Hide' : 'Show'} Overlays
                    </button>
                    <button
                      onClick={() => {
                        setDroneStatus('idle');
                        setDamageAnalysis(null);
                        setModelUrl('');
                        setShowDamageOverlays(false);
                      }}
                      className="px-4 py-3 bg-purple-800 text-white rounded-lg font-medium hover:bg-purple-900 transition-colors"
                    >
                      Reset
                    </button>
                  </>
                )}
              </div>
            </div>

            {/* Progress bar during processing */}
            {droneStatus !== 'idle' && droneStatus !== 'ready' && (
              <div className="mt-4">
                <div className="w-full bg-purple-800 rounded-full h-2 overflow-hidden">
                  <div 
                    className="bg-white h-full transition-all duration-500 rounded-full"
                    style={{ 
                      width: droneStatus === 'uploading' ? '33%' : 
                             droneStatus === 'generating' ? '66%' : 
                             droneStatus === 'analyzing' ? '90%' : '100%'
                    }}
                  />
                </div>
              </div>
            )}

            {/* Damage zones summary when ready */}
            {droneStatus === 'ready' && damageAnalysis && (
              <div className="mt-4 flex items-center gap-4 text-sm">
                <div className="flex items-center gap-2 text-purple-100">
                  <div className="w-3 h-3 bg-blue-400 rounded"></div>
                  <span>Flood: {damageAnalysis.features.filter((f: any) => f.properties.damageType === 'flood').length}</span>
                </div>
                <div className="flex items-center gap-2 text-purple-100">
                  <div className="w-3 h-3 bg-orange-400 rounded"></div>
                  <span>Collapse: {damageAnalysis.features.filter((f: any) => f.properties.damageType === 'collapse').length}</span>
                </div>
                <div className="flex items-center gap-2 text-purple-100">
                  <div className="w-3 h-3 bg-yellow-400 rounded"></div>
                  <span>Debris: {damageAnalysis.features.filter((f: any) => f.properties.damageType === 'debris').length}</span>
                </div>
                <div className="flex items-center gap-2 text-purple-100">
                  <div className="w-3 h-3 bg-red-500 rounded"></div>
                  <span>Fire: {damageAnalysis.features.filter((f: any) => f.properties.damageType === 'fire').length}</span>
                </div>
              </div>
            )}
          </div>

          {/* Map and Responders Grid */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Map Section */}
            <div className="lg:col-span-2 bg-slate-800 rounded-xl p-6 shadow-xl border border-slate-700 relative z-0">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-semibold text-white flex items-center gap-2">
                  <MapPin className="w-5 h-5 text-blue-400" />
                  Responder Locations
                  {showDamageOverlays && <span className="text-sm text-purple-400">(with damage overlays)</span>}
                </h2>
                {droneStatus === 'ready' && (
                  <div className="flex items-center gap-2 text-sm text-slate-400">
                    <Layers className="w-4 h-4" />
                    <span>{damageAnalysis?.features?.length || 0} damage zones detected</span>
                  </div>
                )}
              </div>
              <div className="h-[500px] rounded-lg overflow-hidden">
                <ResponderMap 
                  responders={filteredResponders}
                  damageAnalysis={damageAnalysis}
                  showDamageOverlays={showDamageOverlays}
                />
              </div>
            </div>

            {/* Responders List */}
            <div className="bg-slate-800 rounded-xl p-6 shadow-xl border border-slate-700 relative z-0">
              <h2 className="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <Users className="w-5 h-5 text-purple-400" />
                Responder Details
              </h2>

              {/* Filters */}
              <div className="space-y-3 mb-4">
                {/* Search */}
                <div className="relative">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400" />
                  <input
                    type="text"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    placeholder="Search responders..."
                    className="w-full pl-10 pr-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>

                {/* Type Filter */}
                <div className="flex gap-2">
                  <button
                    onClick={() => setFilterType('all')}
                    className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                      filterType === 'all' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                    }`}
                  >
                    All
                  </button>
                  <button
                    onClick={() => setFilterType('Fire')}
                    className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                      filterType === 'Fire' ? 'bg-orange-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                    }`}
                  >
                    Fire
                  </button>
                  <button
                    onClick={() => setFilterType('Police')}
                    className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                      filterType === 'Police' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                    }`}
                  >
                    Police
                  </button>
                </div>

                {/* Status Filter */}
                <div className="flex gap-2">
                  <button
                    onClick={() => setFilterStatus('all')}
                    className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                      filterStatus === 'all' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                    }`}
                  >
                    All
                  </button>
                  <button
                    onClick={() => setFilterStatus('active')}
                    className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                      filterStatus === 'active' ? 'bg-green-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                    }`}
                  >
                    Active
                  </button>
                  <button
                    onClick={() => setFilterStatus('standby')}
                    className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                      filterStatus === 'standby' ? 'bg-yellow-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                    }`}
                  >
                    Standby
                  </button>
                </div>
              </div>

              {/* Responders List */}
              <div className="space-y-3 max-h-[400px] overflow-y-auto">
                {filteredResponders.length === 0 ? (
                  <div className="text-center py-8 text-slate-400">
                    <Users className="w-12 h-12 mx-auto mb-3 opacity-50" />
                    <p>No responders match your filters</p>
                  </div>
                ) : (
                  filteredResponders.map(responder => (
                    <div key={responder.id} className="bg-slate-700 rounded-lg p-4 hover:bg-slate-650 transition">
                      <div className="flex items-center justify-between mb-2">
                        <div>
                          <div className="font-semibold text-white">{responder.name}</div>
                          <div className="text-xs text-slate-400">{responder.id}</div>
                        </div>
                        <span className={`px-2 py-1 rounded text-xs font-semibold ${
                          responder.type === 'Fire' ? 'bg-orange-600 text-white' : 'bg-blue-600 text-white'
                        }`}>
                          {responder.type}
                        </span>
                      </div>
                      <div className="flex items-center justify-between text-sm">
                        <span className="text-slate-300 flex items-center gap-1">
                          <MapPin className="w-3 h-3" />
                          {responder.location}
                        </span>
                        <StatusBadge status={responder.status} size="sm" />
                      </div>
                    </div>
                  ))
                )}
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* 3D Modal */}
      {show3DModal && modelUrl && (
        <Modal3D 
          modelUrl={modelUrl}
          damageAnalysis={damageAnalysis}
          onClose={() => setShow3DModal(false)}
        />
      )}

      {/* Image Gallery Modal */}
      {showImageGallery && (
        <GalleryModal 
          onClose={() => setShowImageGallery(false)}
        />
      )}
    </ProtectedRoute>
  );
}=== File: src/app/page.tsx ===
'use client';

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '../lib/AuthContext';
import { Shield } from 'lucide-react';

export default function Home() {
  const router = useRouter();
  const { user, loading } = useAuth();

  useEffect(() => {
    if (!loading) {
      if (user) {
        router.push('/dashboard');
      } else {
        router.push('/login');
      }
    }
  }, [user, loading, router]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center">
      <div className="text-center">
        <Shield className="w-16 h-16 text-blue-500 mx-auto mb-4 animate-pulse" />
        <h1 className="text-2xl font-bold text-white mb-2">Crisis Management System</h1>
        <p className="text-slate-400">Redirecting...</p>
      </div>
    </div>
  );
}=== File: src/app/resource-requests/page.tsx ===
'use client';

import React, { useState, useMemo } from 'react';
import { Package, Send, ArrowLeft } from 'lucide-react';
import Link from 'next/link';
import { getHospitalData } from '../../lib/hospitalDataStore';
import { addResourceRequest } from '../../lib/resourceRequestStore';

export default function ResourceRequestsPage() {
  const hospitals = getHospitalData();

  // Dynamically detect valid resource types from hospital data
  const resourceOptions = useMemo(() => {
    if (hospitals.length === 0) {
      return ['Beds', 'ICU', 'Ventilators', 'Oxygen Cylinders', 'PPE Kits', 'Medical Staff'];
    }

    const disallowed = ['id', 'name', 'hospitalName', 'timestamp', 'lastUpdated', 'totalBeds'];
    const keys = new Set<string>();

    hospitals.forEach((hosp) => {
      Object.keys(hosp).forEach((key) => {
        if (!disallowed.includes(key)) {
          keys.add(key);
        }
      });
    });

    // Format the field names properly
    return Array.from(keys)
      .map((k) =>
        k
          .replace(/^available/i, '') // remove "available" prefix
          .replace(/([A-Z])/g, ' $1') // space out camelCase
          .replace(/\s+/g, ' ')
          .trim()
          .replace(/^./, (s) => s.toUpperCase()) // capitalize
      )
      .filter((name) => !['Last Updated', 'Total Beds'].includes(name));
  }, [hospitals]);

  const [formData, setFormData] = useState({
    hospitalName: '',
    resourceType: '',
    quantity: '',
    priority: 'Normal',
  });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    addResourceRequest({
      hospitalName: formData.hospitalName,
      resourceType: formData.resourceType,
      quantity: Number(formData.quantity),
      priority: formData.priority,
    });

    alert(`âœ… Resource request submitted successfully!`);

    setFormData({
      hospitalName: '',
      resourceType: '',
      quantity: '',
      priority: 'Normal',
    });
  };

  return (
    <div className="min-h-screen bg-slate-900 text-white p-8">
      <div className="max-w-2xl mx-auto">
        {/* Back Button */}
        <Link 
          href="/dashboard"
          className="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-6"
        >
          <ArrowLeft className="w-4 h-4" />
          Back to Dashboard
        </Link>

        <div className="bg-slate-800 border border-slate-700 rounded-2xl shadow-xl p-8">
          {/* Header */}
          <div className="flex items-center mb-6">
            <Package className="w-7 h-7 text-emerald-400 mr-3" />
            <h1 className="text-2xl font-bold text-emerald-400">
              Request Additional Resources
            </h1>
          </div>

          <p className="text-slate-400 mb-6">
            Submit a new request for critical resources such as ventilators, oxygen, or staff.
            Requests will be reviewed by coordinators for approval and allocation.
          </p>

          {/* Request Form */}
          <form onSubmit={handleSubmit} className="space-y-5">
            {/* Hospital Selector */}
            <div>
              <label htmlFor="hospitalName" className="block text-slate-300 mb-2 font-medium">
                Hospital Name *
              </label>
              <select
                id="hospitalName"
                name="hospitalName"
                value={formData.hospitalName}
                onChange={handleChange}
                required
                className="w-full bg-slate-700 text-white rounded-lg px-3 py-2 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
              >
                <option value="">Select Hospital</option>
                {hospitals.map((h) => (
                  <option key={h.id || h.name} value={h.name || h.hospitalName}>
                    {h.name || h.hospitalName}
                  </option>
                ))}
              </select>
            </div>

            {/* Resource Type Dropdown */}
            <div>
              <label htmlFor="resourceType" className="block text-slate-300 mb-2 font-medium">
                Resource Type *
              </label>
              <select
                id="resourceType"
                name="resourceType"
                value={formData.resourceType}
                onChange={handleChange}
                required
                className="w-full bg-slate-700 text-white rounded-lg px-3 py-2 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
              >
                <option value="">Select Resource Type</option>
                {resourceOptions.length === 0 ? (
                  <option disabled>No resources available</option>
                ) : (
                  resourceOptions.map((type) => (
                    <option key={type} value={type}>
                      {type}
                    </option>
                  ))
                )}
              </select>
            </div>

            {/* Quantity */}
            <div>
              <label htmlFor="quantity" className="block text-slate-300 mb-2 font-medium">
                Quantity Needed *
              </label>
              <input
                id="quantity"
                type="number"
                name="quantity"
                value={formData.quantity}
                onChange={handleChange}
                placeholder="e.g., 5"
                className="w-full bg-slate-700 text-white rounded-lg px-3 py-2 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                required
                min="1"
              />
            </div>

            {/* Priority */}
            <div>
              <label htmlFor="priority" className="block text-slate-300 mb-2 font-medium">
                Priority Level *
              </label>
              <select
                id="priority"
                name="priority"
                value={formData.priority}
                onChange={handleChange}
                className="w-full bg-slate-700 text-white rounded-lg px-3 py-2 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
              >
                <option value="Normal">Normal</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
              </select>
            </div>

            {/* Submit Button */}
            <button
              type="submit"
              className="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-semibold py-3 rounded-lg flex items-center justify-center gap-2 transition-all"
            >
              <Send className="w-5 h-5" /> Submit Request
            </button>
          </form>
        </div>
      </div>
    </div>
  );
}=== File: src/app/resource-review/page.tsx ===
'use client';

import React, { useEffect, useState } from 'react';
import Link from 'next/link';
import { ArrowLeft, CheckCircle, XCircle, Clock } from 'lucide-react';
import {
  getResourceRequests,
  approveResourceRequest,
  denyResourceRequest,
  onRequestDataChange,
  type ResourceRequest,
} from '../../lib/resourceRequestStore';

export default function ResourceReviewPage() {
  const [requests, setRequests] = useState<ResourceRequest[]>([]);

  useEffect(() => {
    setRequests(getResourceRequests());
    const unsubscribe = onRequestDataChange((updated) => setRequests(updated));
    return () => unsubscribe();
  }, []);

  const handleApprove = (id: string) => {
    approveResourceRequest(id);
    alert('âœ… Resource request approved and added to hospital inventory!');
  };

  const handleDeny = (id: string) => {
    denyResourceRequest(id);
    alert('âŒ Resource request denied.');
  };

  const getPriorityColor = (priority: string) => {
    switch (priority.toLowerCase()) {
      case 'critical':
        return 'bg-red-600 text-white';
      case 'high':
        return 'bg-orange-600 text-white';
      default:
        return 'bg-blue-600 text-white';
    }
  };

  return (
    <div className="min-h-screen bg-slate-900 text-white p-8">
      <div className="max-w-4xl mx-auto">
        {/* Back Button */}
        <Link 
          href="/dashboard"
          className="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-6"
        >
          <ArrowLeft className="w-4 h-4" />
          Back to Dashboard
        </Link>

        <div className="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700 space-y-5">
          <div>
            <h1 className="text-3xl font-bold mb-2 text-purple-400">Resource Requests Review</h1>
            <p className="text-slate-400">
              Review and approve or deny pending resource requests from hospitals.
            </p>
          </div>

          {requests.length === 0 ? (
            <div className="bg-slate-700 rounded-xl p-12 text-center border border-slate-600">
              <Clock className="w-16 h-16 text-slate-500 mx-auto mb-4" />
              <p className="text-slate-400 text-lg font-medium mb-2">No Pending Requests</p>
              <p className="text-slate-500 text-sm">
                All resource requests have been processed.
              </p>
            </div>
          ) : (
            <div className="space-y-4">
              {requests.map((r) => (
                <div
                  key={r.id}
                  className="bg-slate-700 border border-slate-600 p-5 rounded-xl hover:bg-slate-650 transition-all"
                >
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-3">
                        <h3 className="text-xl font-semibold text-white">
                          {r.hospitalName}
                        </h3>
                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${getPriorityColor(r.priority)}`}>
                          {r.priority.toUpperCase()}
                        </span>
                      </div>

                      <div className="space-y-2 text-slate-300">
                        <div className="flex items-center gap-2">
                          <span className="text-slate-500">Resource:</span>
                          <span className="font-semibold text-emerald-400">
                            {r.resourceType}
                          </span>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className="text-slate-500">Quantity:</span>
                          <span className="font-semibold text-white">
                            {r.quantity}
                          </span>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className="text-slate-500">Requested:</span>
                          <span className="text-slate-400 text-sm">
                            {new Date(r.timestamp).toLocaleString()}
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* Action Buttons */}
                    <div className="flex flex-col gap-2">
                      <button
                        onClick={() => handleApprove(r.id)}
                        className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
                      >
                        <CheckCircle className="w-4 h-4" />
                        Approve
                      </button>
                      <button
                        onClick={() => handleDeny(r.id)}
                        className="flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
                      >
                        <XCircle className="w-4 h-4" />
                        Deny
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}

          {/* Summary */}
          {requests.length > 0 && (
            <div className="bg-slate-700 border border-slate-600 p-4 rounded-xl">
              <div className="flex items-center justify-between text-sm">
                <span className="text-slate-400">Total Pending Requests:</span>
                <span className="text-white font-bold text-lg">{requests.length}</span>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}=== File: src/app/responder-management/page.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import ProtectedRoute from '../../components/ProtectedRoute';
import Navigation from '../../components/Navigation';
import Link from 'next/link';
import { Users, MapPin, ArrowLeft, CheckCircle, Radio, AlertCircle } from 'lucide-react';
import StatusBadge from '../../components/StatusBadge';

interface Responder {
  id: string;
  name: string;
  type: 'Fire' | 'Police';
  status: 'active' | 'standby';
  location: string;
  coords?: { lat: number; lng: number };
}

export default function ResponderManagementPage() {
  const [responders, setResponders] = useState<Responder[]>([
    { id: 'FR-101', name: 'Unit Alpha', type: 'Fire', status: 'standby', location: 'Downtown', coords: { lat: 33.7490, lng: -84.3880 } },
    { id: 'FR-102', name: 'Unit Bravo', type: 'Police', status: 'active', location: 'North District', coords: { lat: 33.8958, lng: -84.3014 } },
    { id: 'FR-103', name: 'Unit Charlie', type: 'Fire', status: 'standby', location: 'Station 3', coords: { lat: 33.6407, lng: -84.4277 } },
    { id: 'FR-104', name: 'Unit Delta', type: 'Police', status: 'active', location: 'Highway 5', coords: { lat: 33.7550, lng: -84.4000 } },
  ]);

  const [selectedResponder, setSelectedResponder] = useState<string | null>(null);
  const [trackingLocation, setTrackingLocation] = useState<string | null>(null);

  // Load responder data from localStorage on mount
  useEffect(() => {
    if (typeof window !== 'undefined') {
      const loadedResponders = responders.map(r => {
        const status = localStorage.getItem(`responder_${r.id.toLowerCase()}_status`) as 'active' | 'standby';
        const locationStr = localStorage.getItem(`responder_${r.id.toLowerCase()}_location`);
        let coords = r.coords;
        
        if (locationStr) {
          try {
            coords = JSON.parse(locationStr);
          } catch (e) {
            console.error('Error parsing location:', e);
          }
        }
        
        return {
          ...r,
          status: status || r.status,
          coords
        };
      });
      setResponders(loadedResponders);
    }
  }, []);

  // Update responder status
  const updateStatus = (id: string, newStatus: 'active' | 'standby') => {
    setResponders(prev => prev.map(r => 
      r.id === id ? { ...r, status: newStatus } : r
    ));
    
    // Save to localStorage
    if (typeof window !== 'undefined') {
      localStorage.setItem(`responder_${id.toLowerCase()}_status`, newStatus);
    }
    
    // Trigger storage event for other components
    window.dispatchEvent(new Event('storage'));
  };

  // Start tracking location for a responder
  const startLocationTracking = (id: string) => {
    setTrackingLocation(id);
    
    if ('geolocation' in navigator) {
      navigator.geolocation.watchPosition(
        (position) => {
          const newCoords = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          
          // Update responder location
          setResponders(prev => prev.map(r => 
            r.id === id ? { ...r, coords: newCoords, location: `${newCoords.lat.toFixed(4)}, ${newCoords.lng.toFixed(4)}` } : r
          ));
          
          // Save to localStorage
          if (typeof window !== 'undefined') {
            localStorage.setItem(`responder_${id.toLowerCase()}_location`, JSON.stringify(newCoords));
          }
          
          // Trigger storage event
          window.dispatchEvent(new Event('storage'));
        },
        (error) => {
          console.error('Geolocation error:', error);
          alert('Unable to track location. Please enable location services.');
          setTrackingLocation(null);
        },
        {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        }
      );
    } else {
      alert('Geolocation is not supported by your browser');
    }
  };

  // Stop tracking location
  const stopLocationTracking = () => {
    setTrackingLocation(null);
  };

  const activeCount = responders.filter(r => r.status === 'active').length;
  const standbyCount = responders.filter(r => r.status === 'standby').length;

  return (
    <ProtectedRoute requiredPermissions={['canManageResponders']}>
      <div className="min-h-screen bg-slate-900">
        <Navigation />

        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          {/* Back Button */}
          <Link 
            href="/dashboard"
            className="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 mb-6"
          >
            <ArrowLeft className="w-4 h-4" />
            Back to Dashboard
          </Link>

          {/* Header */}
          <div className="mb-8">
            <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
              <Users className="w-8 h-8 text-purple-500" />
              Responder Management
            </h1>
            <p className="text-slate-400">Manage first responder status and locations</p>
          </div>

          {/* Stats */}
          <div className="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
            <div className="bg-slate-800 rounded-xl p-6 shadow-lg border border-slate-700">
              <div className="flex items-center justify-between mb-2">
                <Users className="w-6 h-6 text-blue-400" />
                <span className="text-2xl font-bold text-white">{responders.length}</span>
              </div>
              <p className="text-slate-400 text-sm">Total Units</p>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 shadow-lg border border-slate-700">
              <div className="flex items-center justify-between mb-2">
                <Radio className="w-6 h-6 text-green-400" />
                <span className="text-2xl font-bold text-white">{activeCount}</span>
              </div>
              <p className="text-slate-400 text-sm">Active Units</p>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 shadow-lg border border-slate-700">
              <div className="flex items-center justify-between mb-2">
                <AlertCircle className="w-6 h-6 text-yellow-400" />
                <span className="text-2xl font-bold text-white">{standbyCount}</span>
              </div>
              <p className="text-slate-400 text-sm">Standby Units</p>
            </div>
          </div>

          {/* Quick Actions */}
          <div className="bg-blue-900/30 border border-blue-600/50 rounded-lg p-4 mb-6">
            <div className="flex items-start gap-3">
              <MapPin className="w-5 h-5 text-blue-400 mt-0.5" />
              <div>
                <h3 className="text-white font-semibold mb-1">Location Tracking</h3>
                <p className="text-blue-200 text-sm">
                  Click "Track Location" on any responder to enable real-time GPS tracking. 
                  Make sure to allow location access in your browser.
                </p>
              </div>
            </div>
          </div>

          {/* Responders Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {responders.map(responder => (
              <div
                key={responder.id}
                className={`bg-slate-800 rounded-xl p-6 shadow-xl border transition-all ${
                  selectedResponder === responder.id
                    ? 'border-blue-500 ring-2 ring-blue-500/50'
                    : 'border-slate-700 hover:border-slate-600'
                }`}
                onClick={() => setSelectedResponder(responder.id)}
              >
                {/* Header */}
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <h3 className="text-lg font-bold text-white">{responder.name}</h3>
                    <p className="text-sm text-slate-400">{responder.id}</p>
                  </div>
                  <span className={`px-3 py-1 rounded-lg text-xs font-semibold ${
                    responder.type === 'Fire' ? 'bg-orange-600 text-white' : 'bg-blue-600 text-white'
                  }`}>
                    {responder.type}
                  </span>
                </div>

                {/* Status */}
                <div className="mb-4">
                  <label className="block text-sm font-medium text-slate-300 mb-2">
                    Current Status
                  </label>
                  <div className="flex items-center justify-between">
                    <StatusBadge status={responder.status} size="md" />
                  </div>
                </div>

                {/* Location */}
                <div className="mb-4">
                  <label className="block text-sm font-medium text-slate-300 mb-2">
                    Location
                  </label>
                  <div className="flex items-start gap-2 text-sm text-slate-400">
                    <MapPin className="w-4 h-4 mt-0.5 flex-shrink-0" />
                    <span>{responder.location}</span>
                  </div>
                  {responder.coords && (
                    <div className="text-xs text-slate-500 mt-1 ml-6">
                      {responder.coords.lat.toFixed(6)}, {responder.coords.lng.toFixed(6)}
                    </div>
                  )}
                </div>

                {/* Action Buttons */}
                <div className="space-y-2">
                  {/* Status Toggle */}
                  <div className="flex gap-2">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        updateStatus(responder.id, 'active');
                      }}
                      className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                        responder.status === 'active'
                          ? 'bg-green-600 text-white'
                          : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                      }`}
                    >
                      Active
                    </button>
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        updateStatus(responder.id, 'standby');
                      }}
                      className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
                        responder.status === 'standby'
                          ? 'bg-yellow-600 text-white'
                          : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                      }`}
                    >
                      Standby
                    </button>
                  </div>

                  {/* Location Tracking */}
                  {trackingLocation === responder.id ? (
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        stopLocationTracking();
                      }}
                      className="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2"
                    >
                      <Radio className="w-4 h-4 animate-pulse" />
                      Stop Tracking
                    </button>
                  ) : (
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        startLocationTracking(responder.id);
                      }}
                      className="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2"
                    >
                      <MapPin className="w-4 h-4" />
                      Track Location
                    </button>
                  )}
                </div>

                {/* Tracking Indicator */}
                {trackingLocation === responder.id && (
                  <div className="mt-3 bg-green-900/30 border border-green-600/50 rounded-lg p-2 flex items-center gap-2">
                    <CheckCircle className="w-4 h-4 text-green-400" />
                    <span className="text-xs text-green-300">Location tracking active</span>
                  </div>
                )}
              </div>
            ))}
          </div>

          {/* View on Map Link */}
          <div className="mt-8 text-center">
            <Link
              href="/map"
              className="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
            >
              <MapPin className="w-5 h-5" />
              View All on Map
            </Link>
          </div>
        </div>
      </div>
    </ProtectedRoute>
  );
}=== File: src/components/AlertSystem.tsx ===
"use client";

import React, { useState, useEffect } from 'react';
import { AlertTriangle, Bell, X, Send, Globe } from 'lucide-react';
import { getAlerts, addAlert, dismissAlert, onAlertsChange } from '../lib/alertStore';
import { translate, translateAlertMessage, getLanguageName, type Language } from '../lib/translationService';

export default function AlertSystem() {
  const [alerts, setAlerts] = useState(getAlerts());
  const [showSubmissionForm, setShowSubmissionForm] = useState(false);
  const [language, setLanguage] = useState<Language>('en');
  const [formData, setFormData] = useState({
    message: '',
    severity: 'moderate' as 'extreme' | 'severe' | 'moderate' | 'minor',
    agency: '',
    area: ''
  });

  // Subscribe to alert changes
  useEffect(() => {
    setAlerts(getAlerts());

    const unsubscribe = onAlertsChange((updatedAlerts) => {
      setAlerts(updatedAlerts);
    });

    return () => unsubscribe();
  }, []);

  const handleSubmit = () => {
    if (!formData.message.trim() || !formData.agency.trim()) {
      alert('Please fill in all required fields');
      return;
    }

    addAlert({
      type: 'other',
      severity: formData.severity,
      message: formData.message,
      area: formData.area || 'General area',
      issued: new Date().toISOString(),
      expires: new Date(Date.now() + 3600000).toISOString(), // 1 hour from now
      agency: formData.agency,
    });
    
    setFormData({ message: '', severity: 'moderate', agency: '', area: '' });
    setShowSubmissionForm(false);
  };

  const handleDismiss = (alertId: number) => {
    dismissAlert(alertId);
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'extreme':
        return 'bg-red-900/30 border-red-600 text-red-100';
      case 'severe':
        return 'bg-orange-900/30 border-orange-600 text-orange-100';
      case 'moderate':
        return 'bg-yellow-900/30 border-yellow-600 text-yellow-100';
      case 'minor':
        return 'bg-blue-900/30 border-blue-600 text-blue-100';
      default:
        return 'bg-slate-800 border-slate-700 text-slate-100';
    }
  };

  const getSeverityBadge = (severity: string) => {
    const badges = {
      extreme: 'bg-red-600 text-white',
      severe: 'bg-orange-600 text-white',
      moderate: 'bg-yellow-600 text-white',
      minor: 'bg-blue-600 text-white'
    };
    return badges[severity as keyof typeof badges] || 'bg-slate-600 text-white';
  };

  return (
    <div className="space-y-4">
      {/* Header */}
      <div className="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-5">
        <div className="flex items-center justify-between flex-wrap gap-4">
          <div>
            <h2 className="text-xl font-bold text-white">Emergency Alerts</h2>
            <p className="text-slate-400 text-sm">Inter-agency communications</p>
          </div>
          
          <div className="flex items-center gap-3">
            {/* Language Selector */}
            <div className="flex items-center gap-2 bg-slate-700 rounded-lg p-1">
              {(['en', 'es', 'fr'] as Language[]).map((lang) => (
                <button
                  key={lang}
                  onClick={() => setLanguage(lang)}
                  className={`px-3 py-1 rounded-md text-xs font-medium transition-all ${
                    language === lang
                      ? 'bg-blue-600 text-white'
                      : 'text-slate-400 hover:text-white'
                  }`}
                >
                  {getLanguageName(lang)}
                </button>
              ))}
            </div>

            <button
              onClick={() => setShowSubmissionForm(!showSubmissionForm)}
              className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2"
            >
              <Send className="w-4 h-4" />
              Submit Alert
            </button>
          </div>
        </div>
      </div>

      {/* Alert Submission Form */}
      {showSubmissionForm && (
        <div className="bg-slate-800 rounded-lg shadow-lg p-5 border-2 border-blue-500">
          <h3 className="text-lg font-semibold mb-4 text-white">Submit Emergency Alert</h3>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                Agency Name *
              </label>
              <input
                type="text"
                value={formData.agency}
                onChange={(e) => setFormData({ ...formData, agency: e.target.value })}
                className="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                placeholder="e.g., Emergency Management"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                Alert Message *
              </label>
              <textarea
                value={formData.message}
                onChange={(e) => setFormData({ ...formData, message: e.target.value })}
                className="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                rows={3}
                placeholder="Enter alert message (will be translated to Spanish and French)"
              />
              <p className="mt-1 text-xs text-slate-400">
                <Globe className="w-3 h-3 inline mr-1" />
                Will be auto-translated to Spanish and French
              </p>
            </div>

            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                Affected Area
              </label>
              <input
                type="text"
                value={formData.area}
                onChange={(e) => setFormData({ ...formData, area: e.target.value })}
                className="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                placeholder="e.g., Downtown District"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                Severity Level *
              </label>
              <select
                value={formData.severity}
                onChange={(e) => setFormData({ ...formData, severity: e.target.value as any })}
                className="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="minor">Minor - Minimal threat</option>
                <option value="moderate">Moderate - Possible threat</option>
                <option value="severe">Severe - Significant threat</option>
                <option value="extreme">Extreme - Life threatening</option>
              </select>
            </div>

            <div className="flex gap-3">
              <button
                onClick={handleSubmit}
                className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
              >
                Broadcast Alert
              </button>
              <button
                onClick={() => setShowSubmissionForm(false)}
                className="bg-slate-600 text-white px-6 py-2 rounded-lg hover:bg-slate-500 transition"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Alert List */}
      {alerts.length > 0 ? (
        <div className="space-y-3">
          {alerts.map((alert) => (
            <div
              key={alert.id}
              className={`border-l-4 rounded-lg shadow-lg p-4 ${getSeverityColor(alert.severity)}`}
            >
              <div className="flex items-start justify-between">
                <div className="flex items-start gap-3 flex-1">
                  <div className="mt-1">
                    {alert.severity === 'extreme' || alert.severity === 'severe' ? (
                      <AlertTriangle className="w-5 h-5" />
                    ) : (
                      <Bell className="w-5 h-5" />
                    )}
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2 flex-wrap">
                      <span className={`text-xs font-bold px-2 py-1 rounded ${getSeverityBadge(alert.severity)}`}>
                        {translate(alert.severity, language, 'severity').toUpperCase()}
                      </span>
                      <span className="text-sm font-semibold">
                        {alert.agency}
                      </span>
                    </div>
                    <p className="font-medium mb-1">
                      {translateAlertMessage(alert.message, language)}
                    </p>
                    {alert.area && (
                      <p className="text-sm opacity-90 mb-1">
                        {translate('affectedArea', language, 'phrase')}: {alert.area}
                      </p>
                    )}
                    <p className="text-xs opacity-80">
                      {translate('issued', language, 'phrase')}: {new Date(alert.issued).toLocaleString(
                        language === 'es' ? 'es-ES' : language === 'fr' ? 'fr-FR' : 'en-US'
                      )}
                    </p>
                  </div>
                </div>
                <button
                  onClick={() => handleDismiss(alert.id)}
                  className="hover:opacity-75 transition"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div className="bg-slate-800 rounded-lg shadow-lg p-8 text-center border border-slate-700">
          <Bell className="w-12 h-12 text-slate-600 mx-auto mb-3" />
          <p className="text-slate-400">
            {language === 'es'
              ? 'No hay alertas activas en este momento'
              : language === 'fr'
              ? 'Aucune alerte active pour le moment'
              : 'No active alerts at this time'}
          </p>
        </div>
      )}
    </div>
  );
}=== File: src/components/AmbulanceCard.tsx ===
import React from 'react';
import { Ambulance } from 'lucide-react';
import StatusBadge from './StatusBadge';
import { AmbulanceType } from '../lib/types';

interface AmbulanceCardProps {
  ambulances: AmbulanceType[];
}

export default function AmbulanceCard({ ambulances }: AmbulanceCardProps) {
  return (
    <div className="bg-slate-800 rounded-lg p-5 shadow-xl border border-slate-700">
      <div className="flex items-center mb-4">
        <Ambulance className="w-6 h-6 mr-2 text-blue-400" />
        <h2 className="text-xl font-semibold">Ambulances</h2>
        <span className="ml-auto bg-blue-600 px-3 py-1 rounded-full text-sm">
          {ambulances.length}
        </span>
      </div>
      <div className="space-y-3">
        {ambulances.map(amb => (
          <div key={amb.id} className="bg-slate-700 rounded p-3 hover:bg-slate-650 transition">
            <div className="flex items-center justify-between mb-2">
              <span className="font-semibold">{amb.id}</span>
              <StatusBadge status={amb.status} />
            </div>
            <div className="text-sm text-slate-300">
              <div>ðŸ“ {amb.location}</div>
              <div className="text-slate-500 text-xs mt-1">
                Updated: {amb.lastUpdate}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}=== File: src/components/Communications.tsx ===
=== File: src/components/DashboardHeader.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import { Bell } from 'lucide-react';
import Link from 'next/link';

export default function DashboardHeader({ alertCount = 0 }: { alertCount?: number }) {
  const [currentTime, setCurrentTime] = useState(new Date());

  useEffect(() => {
    const timer = setInterval(() => setCurrentTime(new Date()), 1000);
    return () => clearInterval(timer);
  }, []);

  return (
    <div className="mb-6 flex justify-between items-center">
      <div>
        <h1 className="text-3xl font-bold mb-1">Crisis Management Dashboard</h1>
        <p className="text-slate-400">Real-time coordination and monitoring</p>
      </div>
      <div className="flex items-center gap-4">
        {/* Alert Bell */}
        <Link href="/alerts" className="relative">
          <Bell className="w-6 h-6 text-slate-400 hover:text-white transition" />
          {alertCount > 0 && (
            <span className="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
              {alertCount}
            </span>
          )}
        </Link>

        {/* Clock */}
        <div className="text-right">
          <div className="text-2xl font-mono">{currentTime.toLocaleTimeString()}</div>
          <div className="text-slate-400">{currentTime.toLocaleDateString()}</div>
        </div>
      </div>
    </div>
  );
}=== File: src/components/DashboardSummary.tsx ===
// components/DashboardSummary.tsx
import { getHospitalData } from '../lib/hospitalDataStore';
import { Building2, Bed, AlertCircle } from 'lucide-react';

export function HospitalSummaryWidget() {
  const hospitals = getHospitalData();
  
  const totalAvailableBeds = hospitals.reduce((sum, h) => sum + h.availableBeds, 0);
  const totalICU = hospitals.reduce((sum, h) => sum + h.availableICU, 0);
  const criticalHospitals = hospitals.filter(h => 
    (h.availableBeds / h.totalBeds) < 0.1
  ).length;

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div className="bg-slate-800 rounded-lg border border-slate-700 p-4">
        <div className="flex items-center gap-2 mb-2">
          <Bed className="w-5 h-5 text-blue-400" />
          <span className="text-slate-400 text-sm">Available Beds</span>
        </div>
        <div className="text-3xl font-bold text-white">{totalAvailableBeds}</div>
      </div>

      <div className="bg-slate-800 rounded-lg border border-slate-700 p-4">
        <div className="flex items-center gap-2 mb-2">
          <AlertCircle className="w-5 h-5 text-red-400" />
          <span className="text-slate-400 text-sm">Critical Capacity</span>
        </div>
        <div className="text-3xl font-bold text-white">{criticalHospitals}</div>
      </div>

      <div className="bg-slate-800 rounded-lg border border-slate-700 p-4">
        <div className="flex items-center gap-2 mb-2">
          <Building2 className="w-5 h-5 text-green-400" />
          <span className="text-slate-400 text-sm">Total Hospitals</span>
        </div>
        <div className="text-3xl font-bold text-white">{hospitals.length}</div>
      </div>
    </div>
  );
}=== File: src/components/DroneControl.tsx ===
// components/DroneControl.tsx
'use client';

import { useState } from 'react';
import { Camera, Image as ImageIcon, Box, AlertCircle, CheckCircle, Loader2 } from 'lucide-react';
import Modal3D from './Modal3D';
import GalleryModal from './GalleryModal';
import { runDroneReconnaissance, getDamageSummary, type DamageAnalysis, type DroneModel } from '../lib/droneService';

export type DroneStatus = 'idle' | 'uploading' | 'generating' | 'analyzing' | 'ready' | 'error';

interface DroneControlProps {
  onStatusChange?: (status: DroneStatus) => void;
  onAnalysisComplete?: (analysis: DamageAnalysis) => void;
}

export default function DroneControl({ onStatusChange, onAnalysisComplete }: DroneControlProps) {
  const [droneStatus, setDroneStatus] = useState<DroneStatus>('idle');
  const [progress, setProgress] = useState(0);
  const [modelUrl, setModelUrl] = useState<string>('');
  const [damageAnalysis, setDamageAnalysis] = useState<DamageAnalysis | null>(null);
  const [error, setError] = useState<string | null>(null);
  
  const [show3DModal, setShow3DModal] = useState(false);
  const [showImageGallery, setShowImageGallery] = useState(false);

  const handleDroneRecon = async () => {
    if (droneStatus !== 'idle') return;
    
    setError(null);
    setProgress(0);

    try {
      const result = await runDroneReconnaissance('demo-mission', (status, prog) => {
        setDroneStatus(status as DroneStatus);
        setProgress(prog);
        if (onStatusChange) onStatusChange(status as DroneStatus);
      });

      setModelUrl(result.model.modelUrl);
      setDamageAnalysis(result.analysis);
      
      if (onAnalysisComplete) {
        onAnalysisComplete(result.analysis);
      }

      // Auto-open 3D modal
      setTimeout(() => setShow3DModal(true), 500);
      
    } catch (err) {
      console.error('Drone recon error:', err);
      setError('Failed to complete drone reconnaissance. Please try again.');
      setDroneStatus('error');
      if (onStatusChange) onStatusChange('error');
    }
  };

  const getStatusIcon = () => {
    switch (droneStatus) {
      case 'idle':
        return <Camera className="w-5 h-5" />;
      case 'uploading':
      case 'generating':
      case 'analyzing':
        return <Loader2 className="w-5 h-5 animate-spin" />;
      case 'ready':
        return <CheckCircle className="w-5 h-5 text-green-400" />;
      case 'error':
        return <AlertCircle className="w-5 h-5 text-red-400" />;
    }
  };

  const getStatusText = () => {
    switch (droneStatus) {
      case 'idle':
        return 'Ready for reconnaissance';
      case 'uploading':
        return 'Processing drone images...';
      case 'generating':
        return 'Generating 3D terrain model...';
      case 'analyzing':
        return 'Analyzing damage patterns...';
      case 'ready':
        return 'Analysis complete';
      case 'error':
        return 'Error occurred';
    }
  };

  const getStatusColor = () => {
    switch (droneStatus) {
      case 'idle':
        return 'bg-slate-700';
      case 'uploading':
      case 'generating':
      case 'analyzing':
        return 'bg-blue-600';
      case 'ready':
        return 'bg-green-600';
      case 'error':
        return 'bg-red-600';
    }
  };

  const summary = damageAnalysis ? getDamageSummary(damageAnalysis) : null;

  return (
    <>
      <div className="bg-slate-800 rounded-xl p-6 shadow-xl border border-slate-700">
        <div className="flex items-center gap-3 mb-4">
          <div className="bg-indigo-600 p-2 rounded-lg">
            <Camera className="w-6 h-6 text-white" />
          </div>
          <div>
            <h3 className="text-lg font-semibold text-white">Drone Reconnaissance</h3>
            <p className="text-sm text-slate-400">Aerial damage assessment</p>
          </div>
        </div>

        {/* Status Indicator */}
        <div className="mb-4">
          <div className="flex items-center gap-2 mb-2">
            {getStatusIcon()}
            <span className="text-sm text-slate-300">{getStatusText()}</span>
          </div>
          
          {/* Progress Bar */}
          {(droneStatus !== 'idle' && droneStatus !== 'error') && (
            <div className="w-full bg-slate-700 rounded-full h-2">
              <div
                className={`h-2 rounded-full transition-all duration-300 ${getStatusColor()}`}
                style={{ width: `${progress}%` }}
              />
            </div>
          )}
        </div>

        {/* Error Message */}
        {error && (
          <div className="mb-4 bg-red-900/30 border border-red-600 rounded-lg p-3">
            <div className="flex items-start gap-2">
              <AlertCircle className="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" />
              <p className="text-sm text-red-200">{error}</p>
            </div>
          </div>
        )}

        {/* Action Button */}
        <button
          onClick={handleDroneRecon}
          disabled={droneStatus !== 'idle' && droneStatus !== 'error'}
          className={`w-full py-3 rounded-lg font-semibold transition-all ${
            droneStatus === 'idle' || droneStatus === 'error'
              ? 'bg-indigo-600 hover:bg-indigo-700 text-white'
              : 'bg-slate-600 cursor-not-allowed text-slate-400'
          }`}
        >
          {droneStatus === 'idle' ? (
            <>ðŸš Start Drone Reconnaissance</>
          ) : droneStatus === 'error' ? (
            <>ðŸ”„ Retry Reconnaissance</>
          ) : (
            <>{droneStatus.toUpperCase()}...</>
          )}
        </button>

        {/* Results Section */}
        {droneStatus === 'ready' && summary && (
          <div className="mt-4 space-y-3">
            {/* Summary Stats */}
            <div className="bg-slate-700/50 rounded-lg p-4">
              <h4 className="text-sm font-semibold text-white mb-3">Damage Assessment</h4>
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <p className="text-xs text-slate-400">Total Areas</p>
                  <p className="text-lg font-bold text-white">{summary.total}</p>
                </div>
                <div>
                  <p className="text-xs text-slate-400">Avg Severity</p>
                  <p className="text-lg font-bold text-white">{summary.averageSeverity.toFixed(1)}/10</p>
                </div>
                <div>
                  <p className="text-xs text-slate-400">High Priority</p>
                  <p className="text-lg font-bold text-red-400">{summary.highSeverity}</p>
                </div>
                <div>
                  <p className="text-xs text-slate-400">Medium Priority</p>
                  <p className="text-lg font-bold text-orange-400">{summary.mediumSeverity}</p>
                </div>
              </div>
            </div>

            {/* Action Buttons */}
            <div className="flex gap-2">
              <button
                onClick={() => setShow3DModal(true)}
                className="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2"
              >
                <Box className="w-4 h-4" />
                View 3D Model
              </button>
              <button
                onClick={() => setShowImageGallery(true)}
                className="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2"
              >
                <ImageIcon className="w-4 h-4" />
                View Images
              </button>
            </div>

            {/* Damage Type Breakdown */}
            <div className="bg-slate-700/50 rounded-lg p-3">
              <h4 className="text-xs font-semibold text-slate-300 mb-2">Damage Types</h4>
              <div className="space-y-1">
                {Object.entries(summary.byType).map(([type, count]) => (
                  <div key={type} className="flex items-center justify-between text-xs">
                    <span className="text-slate-400 capitalize">{type}</span>
                    <span className="text-white font-semibold">{count}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}
      </div>

      {/* Modals */}
      {show3DModal && modelUrl && (
        <Modal3D
          modelUrl={modelUrl}
          damageAnalysis={damageAnalysis}
          onClose={() => setShow3DModal(false)}
        />
      )}

      {showImageGallery && (
        <GalleryModal onClose={() => setShowImageGallery(false)} />
      )}
    </>
  );
}=== File: src/components/FirstResponderCard.tsx ===
=== File: src/components/GalleryModal.tsx ===
// components/GalleryModal.tsx
'use client';

import { useState } from 'react';
import { X, ZoomIn, Download } from 'lucide-react';
import Image from 'next/image';

interface GalleryModalProps {
  onClose: () => void;
  images?: string[];
}

export default function GalleryModal({ onClose, images }: GalleryModalProps) {
  const [selectedImg, setSelectedImg] = useState<string | null>(null);
  const [selectedIndex, setSelectedIndex] = useState<number>(0);

  // Mock processed drone images (these would come from your API in production)
  const mockImages = images || [
    '/uploads/drone/proc-img1.jpg',
    '/uploads/drone/proc-img2.jpg',
    '/uploads/drone/proc-img3.jpg',
    '/uploads/drone/proc-img4.jpg',
    '/uploads/drone/proc-img5.jpg',
  ];

  const handleImageClick = (img: string, index: number) => {
    setSelectedImg(img);
    setSelectedIndex(index);
  };

  const handleNext = () => {
    const nextIndex = (selectedIndex + 1) % mockImages.length;
    setSelectedIndex(nextIndex);
    setSelectedImg(mockImages[nextIndex]);
  };

  const handlePrev = () => {
    const prevIndex = selectedIndex === 0 ? mockImages.length - 1 : selectedIndex - 1;
    setSelectedIndex(prevIndex);
    setSelectedImg(mockImages[prevIndex]);
  };

  const handleDownload = (img: string) => {
    // In production, this would trigger actual download
    console.log('Downloading:', img);
    alert('Download functionality - Connect to actual file system');
  };

  return (
    <div className="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
      <div className="w-full h-full max-w-7xl max-h-[90vh] bg-slate-900 rounded-xl overflow-hidden relative">
        {/* Header */}
        <div className="absolute top-0 left-0 right-0 bg-slate-800/90 backdrop-blur-sm p-4 z-10 border-b border-slate-700">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-xl font-bold text-white">Drone Image Gallery</h2>
              <p className="text-sm text-slate-400">
                {mockImages.length} processed images from reconnaissance mission
              </p>
            </div>
            <button
              onClick={onClose}
              className="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2"
            >
              <X className="w-4 h-4" />
              Close
            </button>
          </div>
        </div>

        {/* Content */}
        <div className="w-full h-full pt-20 p-4">
          {selectedImg ? (
            /* Full Screen View */
            <div className="relative w-full h-full flex items-center justify-center">
              {/* Image */}
              <div className="relative max-w-5xl max-h-full">
                <Image
                  src={selectedImg}
                  alt={`Drone Image ${selectedIndex + 1}`}
                  width={1200}
                  height={800}
                  className="max-w-full max-h-[calc(90vh-8rem)] object-contain rounded-lg"
                  priority
                />
                
                {/* Image Info Overlay */}
                <div className="absolute bottom-4 left-4 bg-slate-800/90 backdrop-blur-sm p-3 rounded-lg">
                  <p className="text-white text-sm font-semibold">
                    Image {selectedIndex + 1} of {mockImages.length}
                  </p>
                  <p className="text-slate-400 text-xs">
                    GPS: 33.7490Â°N, 84.3880Â°W â€¢ Altitude: 120m
                  </p>
                </div>
              </div>

              {/* Navigation Buttons */}
              <button
                onClick={handlePrev}
                className="absolute left-4 top-1/2 -translate-y-1/2 bg-slate-800/90 hover:bg-slate-700 text-white p-3 rounded-full transition-colors"
                title="Previous"
              >
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
              </button>

              <button
                onClick={handleNext}
                className="absolute right-4 top-1/2 -translate-y-1/2 bg-slate-800/90 hover:bg-slate-700 text-white p-3 rounded-full transition-colors"
                title="Next"
              >
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
              </button>

              {/* Action Buttons */}
              <div className="absolute top-4 right-4 flex gap-2">
                <button
                  onClick={() => handleDownload(selectedImg)}
                  className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg transition-colors"
                  title="Download"
                >
                  <Download className="w-5 h-5" />
                </button>
                <button
                  onClick={() => setSelectedImg(null)}
                  className="bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg transition-colors"
                >
                  Back to Gallery
                </button>
              </div>
            </div>
          ) : (
            /* Grid View */
            <div className="w-full h-full overflow-y-auto">
              <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pb-4">
                {mockImages.map((img, index) => (
                  <div
                    key={index}
                    className="bg-slate-800 rounded-lg overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all cursor-pointer group"
                    onClick={() => handleImageClick(img, index)}
                  >
                    <div className="relative aspect-video">
                      <Image
                        src={img}
                        alt={`Drone Image ${index + 1}`}
                        fill
                        className="object-cover"
                        sizes="(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"
                      />
                      <div className="absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center">
                        <ZoomIn className="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity" />
                      </div>
                    </div>
                    <div className="p-3">
                      <p className="text-sm text-slate-300 font-semibold">Image {index + 1}</p>
                      <p className="text-xs text-slate-500">Processed â€¢ Ready</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}=== File: src/components/HospitalCard.tsx ===
=== File: src/components/HospitalResourceForm.tsx ===
// components/HospitalResourceForm.tsx
'use client';

import React, { useState } from 'react';
import { saveHospitalData, getHospitalData, HospitalData } from '../lib/hospitalDataStore';
import { Building2, CheckCircle } from 'lucide-react';

export default function HospitalResourceForm() {
  const [formData, setFormData] = useState({
    hospitalName: '',
    totalBeds: '',
    availableBeds: '',
    availableICU: '',
    ventilators: '',
  });

  const [showSuccess, setShowSuccess] = useState(false);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();

    const hospitals = getHospitalData();
    const existingIndex = hospitals.findIndex(
      (h) => h.name.toLowerCase() === formData.hospitalName.trim().toLowerCase()
    );

    const newHospital: HospitalData = {
      name: formData.hospitalName.trim(),
      totalBeds: Number(formData.totalBeds),
      availableBeds: Number(formData.availableBeds),
      availableICU: Number(formData.availableICU),
      ventilators: Number(formData.ventilators),
      lastUpdated: new Date().toISOString(),
    };

    if (existingIndex !== -1) {
      // Update existing hospital
      hospitals[existingIndex] = {
        ...hospitals[existingIndex],
        ...newHospital,
      };
    } else {
      // Add new hospital with generated ID
      const newId = `HSP-${String(hospitals.length + 1).padStart(3, '0')}`;
      hospitals.push({
        ...newHospital,
        id: newId,
      });
    }

    saveHospitalData(hospitals);

    // Clear form
    setFormData({
      hospitalName: '',
      totalBeds: '',
      availableBeds: '',
      availableICU: '',
      ventilators: '',
    });

    // Show success message
    setShowSuccess(true);
    setTimeout(() => setShowSuccess(false), 3000);
  };

  return (
    <div className="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700">
      <div className="flex items-center gap-3 mb-6">
        <div className="bg-emerald-600 p-2 rounded-lg">
          <Building2 className="w-6 h-6 text-white" />
        </div>
        <h2 className="text-xl font-semibold text-white">Add or Update Hospital</h2>
      </div>

      {/* Success Message */}
      {showSuccess && (
        <div className="mb-6 bg-green-900/30 border border-green-600 rounded-lg p-4">
          <div className="flex items-center gap-2 text-green-400">
            <CheckCircle className="w-5 h-5" />
            <span className="font-semibold">Hospital data saved successfully!</span>
          </div>
        </div>
      )}

      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label htmlFor="hospitalName" className="block text-sm text-slate-300 mb-1">
            Hospital Name *
          </label>
          <input
            id="hospitalName"
            type="text"
            name="hospitalName"
            placeholder="e.g., Central Medical Center"
            value={formData.hospitalName}
            onChange={handleChange}
            className="w-full px-3 py-2 rounded-lg bg-slate-700 text-white border border-slate-600 focus:ring-2 focus:ring-emerald-500 focus:outline-none"
            required
          />
        </div>

        <div>
          <label htmlFor="totalBeds" className="block text-sm text-slate-300 mb-1">
            Total Beds *
          </label>
          <input
            id="totalBeds"
            type="number"
            name="totalBeds"
            placeholder="e.g., 100"
            value={formData.totalBeds}
            onChange={handleChange}
            className="w-full px-3 py-2 rounded-lg bg-slate-700 text-white border border-slate-600 focus:ring-2 focus:ring-emerald-500 focus:outline-none"
            required
            min="0"
          />
        </div>

        <div>
          <label htmlFor="availableBeds" className="block text-sm text-slate-300 mb-1">
            Available Beds *
          </label>
          <input
            id="availableBeds"
            type="number"
            name="availableBeds"
            placeholder="e.g., 25"
            value={formData.availableBeds}
            onChange={handleChange}
            className="w-full px-3 py-2 rounded-lg bg-slate-700 text-white border border-slate-600 focus:ring-2 focus:ring-emerald-500 focus:outline-none"
            required
            min="0"
          />
        </div>

        <div>
          <label htmlFor="availableICU" className="block text-sm text-slate-300 mb-1">
            ICU Beds Available *
          </label>
          <input
            id="availableICU"
            type="number"
            name="availableICU"
            placeholder="e.g., 10"
            value={formData.availableICU}
            onChange={handleChange}
            className="w-full px-3 py-2 rounded-lg bg-slate-700 text-white border border-slate-600 focus:ring-2 focus:ring-emerald-500 focus:outline-none"
            required
            min="0"
          />
        </div>

        <div>
          <label htmlFor="ventilators" className="block text-sm text-slate-300 mb-1">
            Ventilators Available *
          </label>
          <input
            id="ventilators"
            type="number"
            name="ventilators"
            placeholder="e.g., 15"
            value={formData.ventilators}
            onChange={handleChange}
            className="w-full px-3 py-2 rounded-lg bg-slate-700 text-white border border-slate-600 focus:ring-2 focus:ring-emerald-500 focus:outline-none"
            required
            min="0"
          />
        </div>

        <button
          type="submit"
          className="w-full bg-emerald-600 hover:bg-emerald-500 py-2 rounded-lg font-semibold text-white transition-colors"
        >
          Save Hospital Data
        </button>
      </form>
    </div>
  );
}=== File: src/components/HospitalResourcePanel.tsx ===
// components/HospitalResourcePanel.tsx
'use client';

import React, { useEffect, useState } from 'react';
import { Building2, Bed, Activity, HeartPulse, Clock } from 'lucide-react';
import { getHospitalData, onHospitalDataChange, HospitalData } from '../lib/hospitalDataStore';

interface HospitalResourcePanelProps {
  data?: HospitalData[];
  compact?: boolean;
}

export default function HospitalResourcePanel({ data, compact = false }: HospitalResourcePanelProps) {
  const [hospitals, setHospitals] = useState<HospitalData[]>(data || getHospitalData());

  useEffect(() => {
    // If data prop is provided, use it (controlled component)
    if (data) {
      setHospitals(data);
      return;
    }

    // Otherwise, load from store and subscribe to changes
    setHospitals(getHospitalData());

    const unsubscribe = onHospitalDataChange((updatedData) => {
      setHospitals(updatedData);
    });

    return () => unsubscribe();
  }, [data]);

  const getCapacityColor = (available: number, total: number): string => {
    const percentage = (available / total) * 100;
    if (percentage <= 10) return 'text-red-400';
    if (percentage <= 30) return 'text-yellow-400';
    return 'text-green-400';
  };

  const getCapacityBar = (available: number, total: number) => {
    const percentage = Math.min((available / total) * 100, 100);
    const colorClass = percentage <= 10 ? 'bg-red-500' : 
                       percentage <= 30 ? 'bg-yellow-500' : 'bg-green-500';
    
    return (
      <div className="w-full bg-slate-700 rounded-full h-2 overflow-hidden">
        <div 
          className={`h-full ${colorClass} transition-all duration-300`}
          style={{ width: `${percentage}%` }}
        />
      </div>
    );
  };

  if (hospitals.length === 0) {
    return (
      <div className="bg-slate-800 rounded-xl border border-slate-700 p-6 text-center">
        <Building2 className="w-12 h-12 text-slate-600 mx-auto mb-3" />
        <p className="text-slate-400">No hospital data available</p>
      </div>
    );
  }

  if (compact) {
    return (
      <div className="space-y-3">
        {hospitals.map((hospital) => (
          <div
            key={hospital.id || hospital.name}
            className="bg-slate-800 rounded-lg border border-slate-700 p-4 hover:border-slate-600 transition-colors"
          >
            <div className="flex items-center justify-between mb-2">
              <h4 className="font-semibold text-white">{hospital.name}</h4>
              <span className={`text-lg font-bold ${getCapacityColor(hospital.availableBeds, hospital.totalBeds)}`}>
                {hospital.availableBeds}
              </span>
            </div>
            {getCapacityBar(hospital.availableBeds, hospital.totalBeds)}
          </div>
        ))}
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {hospitals.map((hospital) => {
        const bedPercentage = Math.round((hospital.availableBeds / hospital.totalBeds) * 100);
        
        return (
          <div
            key={hospital.id || hospital.name}
            className="bg-slate-800 rounded-xl border border-slate-700 p-6 hover:border-slate-600 transition-all"
          >
            {/* Hospital Header */}
            <div className="flex items-start justify-between mb-4">
              <div className="flex items-center gap-3">
                <div className="bg-blue-600 p-3 rounded-lg">
                  <Building2 className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h3 className="text-lg font-semibold text-white">{hospital.name}</h3>
                  <p className="text-sm text-slate-400">
                    Total Capacity: {hospital.totalBeds} beds
                  </p>
                </div>
              </div>
              
              {/* Status Indicator */}
              <div className={`px-3 py-1 rounded-full text-xs font-semibold ${
                bedPercentage <= 10 ? 'bg-red-600 text-white' :
                bedPercentage <= 30 ? 'bg-yellow-600 text-white' :
                'bg-green-600 text-white'
              }`}>
                {bedPercentage <= 10 ? 'Critical' : bedPercentage <= 30 ? 'Limited' : 'Available'}
              </div>
            </div>

            {/* Resource Grid */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              {/* General Beds */}
              <div className="bg-slate-700/50 rounded-lg p-4">
                <div className="flex items-center gap-2 mb-2">
                  <Bed className="w-5 h-5 text-blue-400" />
                  <span className="text-sm text-slate-400">General Beds</span>
                </div>
                <div className={`text-2xl font-bold ${getCapacityColor(hospital.availableBeds, hospital.totalBeds)}`}>
                  {hospital.availableBeds}
                </div>
                <div className="text-xs text-slate-500">of {hospital.totalBeds} total</div>
                <div className="mt-2">
                  {getCapacityBar(hospital.availableBeds, hospital.totalBeds)}
                </div>
              </div>

              {/* ICU Beds */}
              <div className="bg-slate-700/50 rounded-lg p-4">
                <div className="flex items-center gap-2 mb-2">
                  <HeartPulse className="w-5 h-5 text-red-400" />
                  <span className="text-sm text-slate-400">ICU Beds</span>
                </div>
                <div className="text-2xl font-bold text-white">
                  {hospital.availableICU}
                </div>
                <div className="text-xs text-slate-500">available</div>
              </div>

              {/* Ventilators */}
              <div className="bg-slate-700/50 rounded-lg p-4">
                <div className="flex items-center gap-2 mb-2">
                  <Activity className="w-5 h-5 text-purple-400" />
                  <span className="text-sm text-slate-400">Ventilators</span>
                </div>
                <div className="text-2xl font-bold text-white">
                  {hospital.ventilators}
                </div>
                <div className="text-xs text-slate-500">available</div>
              </div>

              {/* Last Updated */}
              <div className="bg-slate-700/50 rounded-lg p-4">
                <div className="flex items-center gap-2 mb-2">
                  <Clock className="w-5 h-5 text-slate-400" />
                  <span className="text-sm text-slate-400">Last Update</span>
                </div>
                <div className="text-sm text-white">
                  {new Date(hospital.lastUpdated).toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                  })}
                </div>
                <div className="text-xs text-slate-500">
                  {new Date(hospital.lastUpdated).toLocaleDateString([], { 
                    month: 'short', 
                    day: 'numeric' 
                  })}
                </div>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  );
}=== File: src/components/LiveClock.tsx ===
'use client';

import { useState, useEffect } from 'react';

export default function LiveClock() {
  const [time, setTime] = useState(new Date());

  useEffect(() => {
    const interval = setInterval(() => setTime(new Date()), 1000);
    return () => clearInterval(interval);
  }, []);

  return (
    <div className="text-right">
      <div className="text-2xl font-mono">{time.toLocaleTimeString()}</div>
      <div className="text-slate-400">{time.toLocaleDateString()}</div>
    </div>
  );
}=== File: src/components/Modal3D.tsx ===
'use client';

import { useEffect, useRef } from 'react';
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

interface Modal3DProps {
  modelUrl: string;
  damageAnalysis?: any;
  onClose: () => void;
}

export default function Modal3D({ modelUrl, damageAnalysis, onClose }: Modal3DProps) {
  const canvasRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!canvasRef.current || !modelUrl || typeof window === 'undefined') return;

    const { current } = canvasRef;
    current.innerHTML = '';

    // Scene setup
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0f172a); // Slate-900 background
    
    const camera = new THREE.PerspectiveCamera(
      75, 
      current.clientWidth / current.clientHeight, 
      0.1, 
      1000
    );
    
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(current.clientWidth, current.clientHeight);
    current.appendChild(renderer.domElement);

    // Camera controls
    const controls = new OrbitControls(camera, renderer.domElement);
    camera.position.set(0, 20, 300);
    camera.lookAt(0, 0, 0);
    controls.target.set(0, 0, 0);
    controls.enableZoom = true;
    controls.enablePan = true;
    controls.enableRotate = true;

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(50, 100, 50);
    scene.add(directionalLight);

    // Load 3D model
    const loader = new GLTFLoader();
    loader.load(
      modelUrl, 
      (gltf) => {
        console.log('Modal3D: 3D terrain model loaded successfully');
        scene.add(gltf.scene);
        controls.update();
      }, 
      (progress) => {
        console.log(`Loading: ${(progress.loaded / progress.total * 100).toFixed(0)}%`);
      },
      (err) => {
        console.error('GLTF load error in modal:', err);
      }
    );

    // Add damage visualization cubes if analysis data exists
    if (damageAnalysis?.features) {
      console.log('Modal3D: Rendering', damageAnalysis.features.length, 'damage zones');
      
      damageAnalysis.features.forEach((feat: any, index: number) => {
        const props = feat.properties;
        
        // Only show high-severity damage
        if (props?.severity > 7) {
          const geometry = new THREE.BoxGeometry(0.1, 0.1, 0.1);
          
          // Color based on damage type
          let color = 0xff0000; // Default red
          if (props.damageType === 'flood') color = 0x0088ff;
          if (props.damageType === 'collapse') color = 0xff6600;
          if (props.damageType === 'debris') color = 0xffaa00;
          
          const material = new THREE.MeshBasicMaterial({ 
            color, 
            wireframe: true,
            opacity: 0.7,
            transparent: true
          });
          
          const cube = new THREE.Mesh(geometry, material);
          
          // Position cubes in a grid pattern
          const row = Math.floor(index / 5);
          const col = index % 5;
          cube.position.set(
            (col - 2) * 0.3,  // Spread horizontally
            0.2,              // Slightly elevated
            row * 0.3         // Spread in depth
          );
          
          scene.add(cube);
        }
      });
    }

    // Animation loop
    const animate = () => {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    };
    animate();

    // Handle window resize
    const handleResize = () => {
      if (current && renderer) {
        const { clientWidth, clientHeight } = current;
        camera.aspect = clientWidth / clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(clientWidth, clientHeight);
      }
    };
    window.addEventListener('resize', handleResize);

    // Cleanup
    return () => {
      window.removeEventListener('resize', handleResize);
      renderer.dispose();
      scene.clear();
    };
  }, [modelUrl, damageAnalysis]);

  return (
    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4">
      <div className="w-full max-w-6xl h-[85vh] bg-slate-900 rounded-xl shadow-2xl border border-slate-700 overflow-hidden relative">
        {/* Header */}
        <div className="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
          <div>
            <h3 className="text-xl font-bold text-white">3D Terrain Analysis</h3>
            <p className="text-sm text-slate-400 mt-1">Drone-generated damage assessment visualization</p>
          </div>
          <button 
            onClick={onClose} 
            className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors flex items-center gap-2"
          >
            <span>âœ•</span>
            Close
          </button>
        </div>

        {/* 3D Canvas */}
        <div ref={canvasRef} className="w-full h-[calc(100%-80px)] bg-slate-950" />

        {/* Legend */}
        {damageAnalysis?.features && (
          <div className="absolute bottom-4 left-4 bg-slate-800/90 backdrop-blur-sm rounded-lg p-4 border border-slate-700">
            <h4 className="text-sm font-semibold text-white mb-2">Damage Types</h4>
            <div className="space-y-1 text-xs">
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 bg-red-500 rounded"></div>
                <span className="text-slate-300">Structural</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 bg-blue-500 rounded"></div>
                <span className="text-slate-300">Flood</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 bg-orange-500 rounded"></div>
                <span className="text-slate-300">Collapse</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 bg-yellow-500 rounded"></div>
                <span className="text-slate-300">Debris</span>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}=== File: src/components/MultilingualAlertSystem.tsx ===
// components/MultilingualAlertSystem.tsx
'use client';

import React, { useState, useEffect } from 'react';
import { 
  Bell, 
  AlertTriangle, 
  AlertCircle, 
  Info, 
  X, 
  Globe,
  MapPin,
  Clock,
  Users 
} from 'lucide-react';
import {
  translate,
  translateAlertMessage,
  getLanguageName,
  getLanguageFlag,
  getPreferredLanguage,
  setPreferredLanguage,
  type Language
} from '../lib/translationService';
import { getActiveAlerts, dismissAlert, onAlertsChange, initializeSampleAlerts } from '../lib/alertStore';
import type { Alert } from '../lib/alertStore';

interface MultilingualAlertSystemProps {
  alerts?: Alert[];
  onDelete?: (alertId: number) => void;
  autoInitialize?: boolean;
}

export default function MultilingualAlertSystem({ 
  alerts: propAlerts, 
  onDelete,
  autoInitialize = false 
}: MultilingualAlertSystemProps) {
  const [language, setLanguage] = useState<Language>('en');
  const [alerts, setAlerts] = useState<Alert[]>([]);

  useEffect(() => {
    // Load preferred language
    const preferred = getPreferredLanguage();
    setLanguage(preferred);

    // Initialize sample alerts if needed
    if (autoInitialize) {
      initializeSampleAlerts();
    }

    // Load alerts
    if (propAlerts) {
      setAlerts(propAlerts);
    } else {
      setAlerts(getActiveAlerts());
    }

    // Subscribe to alert changes
    const unsubscribe = onAlertsChange((updatedAlerts) => {
      if (!propAlerts) {
        setAlerts(updatedAlerts);
      }
    });

    return () => unsubscribe();
  }, [propAlerts, autoInitialize]);

  const handleLanguageChange = (newLang: Language) => {
    setLanguage(newLang);
    setPreferredLanguage(newLang);
  };

  const handleDismiss = (alertId: number) => {
    if (onDelete) {
      onDelete(alertId);
    } else {
      dismissAlert(alertId);
    }
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case 'extreme':
        return 'bg-red-900/90 border-red-600';
      case 'severe':
        return 'bg-orange-900/90 border-orange-600';
      case 'moderate':
        return 'bg-yellow-900/90 border-yellow-600';
      case 'minor':
        return 'bg-blue-900/90 border-blue-600';
      default:
        return 'bg-slate-800/90 border-slate-600';
    }
  };

  const getSeverityIcon = (severity: string) => {
    switch (severity) {
      case 'extreme':
        return <AlertTriangle className="w-6 h-6" />;
      case 'severe':
        return <AlertCircle className="w-6 h-6" />;
      case 'moderate':
        return <Info className="w-6 h-6" />;
      default:
        return <Bell className="w-6 h-6" />;
    }
  };

  const formatTime = (isoString: string) => {
    return new Date(isoString).toLocaleString(
      language === 'es' ? 'es-ES' : language === 'fr' ? 'fr-FR' : 'en-US',
      {
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      }
    );
  };

  if (alerts.length === 0) {
    return (
      <div className="bg-slate-800 rounded-xl border border-slate-700 p-8 text-center">
        <Bell className="w-12 h-12 text-slate-600 mx-auto mb-4" />
        <p className="text-slate-400">
          {language === 'es' 
            ? 'No hay alertas activas en este momento'
            : language === 'fr'
            ? 'Aucune alerte active pour le moment'
            : 'No active alerts at this time'}
        </p>

        {/* Language Selector */}
        <div className="mt-6 flex justify-center gap-2">
          {(['en', 'es', 'fr'] as Language[]).map((lang) => (
            <button
              key={lang}
              onClick={() => handleLanguageChange(lang)}
              className={`px-4 py-2 rounded-lg border transition-all ${
                language === lang
                  ? 'bg-blue-600 border-blue-500 text-white'
                  : 'bg-slate-700 border-slate-600 text-slate-300 hover:bg-slate-600'
              }`}
            >
              {getLanguageFlag(lang)} {getLanguageName(lang)}
            </button>
          ))}
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {/* Language Selector */}
      <div className="bg-slate-800 rounded-xl border border-slate-700 p-4">
        <div className="flex items-center justify-between flex-wrap gap-4">
          <div className="flex items-center gap-2">
            <Globe className="w-5 h-5 text-blue-400" />
            <span className="text-white font-medium">
              {language === 'es' 
                ? 'Seleccionar idioma:'
                : language === 'fr'
                ? 'SÃ©lectionner la langue:'
                : 'Select Language:'}
            </span>
          </div>
          <div className="flex gap-2">
            {(['en', 'es', 'fr'] as Language[]).map((lang) => (
              <button
                key={lang}
                onClick={() => handleLanguageChange(lang)}
                className={`px-4 py-2 rounded-lg border transition-all ${
                  language === lang
                    ? 'bg-blue-600 border-blue-500 text-white'
                    : 'bg-slate-700 border-slate-600 text-slate-300 hover:bg-slate-600'
                }`}
              >
                {getLanguageFlag(lang)} {getLanguageName(lang)}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Alert Cards */}
      {alerts.map((alert) => (
        <div
          key={alert.id}
          className={`rounded-xl border p-6 backdrop-blur-sm ${getSeverityColor(alert.severity)}`}
        >
          <div className="flex items-start justify-between gap-4">
            <div className="flex gap-4 flex-1">
              {/* Icon */}
              <div className="text-white">
                {getSeverityIcon(alert.severity)}
              </div>

              {/* Content */}
              <div className="flex-1 space-y-3">
                {/* Header */}
                <div className="flex items-center gap-3 flex-wrap">
                  <h3 className="text-xl font-bold text-white">
                    {translate(alert.type, language, 'type')}
                  </h3>
                  <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                    alert.severity === 'extreme' ? 'bg-red-600 text-white' :
                    alert.severity === 'severe' ? 'bg-orange-600 text-white' :
                    alert.severity === 'moderate' ? 'bg-yellow-600 text-white' :
                    'bg-blue-600 text-white'
                  }`}>
                    {translate(alert.severity, language, 'severity')}
                  </span>
                </div>

                {/* Message */}
                <p className="text-white text-lg leading-relaxed">
                  {translateAlertMessage(alert.message, language)}
                </p>

                {/* Area */}
                <div className="flex items-center gap-2 text-white/90">
                  <MapPin className="w-4 h-4" />
                  <span className="font-medium">
                    {translate('affectedArea', language, 'phrase')}:
                  </span>
                  <span>{alert.area}</span>
                </div>

                {/* Instructions */}
                {alert.instructions && (
                  <div className="bg-black/30 rounded-lg p-4 border border-white/20">
                    <p className="text-sm font-semibold text-white mb-2">
                      {translate('instructions', language, 'phrase')}:
                    </p>
                    <p className="text-white/90">
                      {translateAlertMessage(alert.instructions, language)}
                    </p>
                  </div>
                )}

                {/* Metadata */}
                <div className="flex flex-wrap gap-4 text-sm text-white/80">
                  <div className="flex items-center gap-1">
                    <Clock className="w-4 h-4" />
                    <span>
                      {translate('issued', language, 'phrase')}: {formatTime(alert.issued)}
                    </span>
                  </div>
                  <div className="flex items-center gap-1">
                    <Clock className="w-4 h-4" />
                    <span>
                      {translate('expires', language, 'phrase')}: {formatTime(alert.expires)}
                    </span>
                  </div>
                  {alert.affectedPopulation && (
                    <div className="flex items-center gap-1">
                      <Users className="w-4 h-4" />
                      <span>
                        {translate('population', language, 'phrase')}: {alert.affectedPopulation.toLocaleString()}
                      </span>
                    </div>
                  )}
                </div>

                {/* Agency */}
                <div className="text-xs text-white/70">
                  {translate('agency', language, 'phrase')}: {alert.agency}
                </div>
              </div>
            </div>

            {/* Dismiss Button */}
            <button
              onClick={() => handleDismiss(alert.id)}
              className="text-white/70 hover:text-white hover:bg-white/10 p-2 rounded-lg transition-colors"
              title="Dismiss alert"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
      ))}

      {/* Footer Help Text */}
      <div className="bg-slate-800/50 rounded-lg p-3 text-center text-sm text-slate-400">
        <p>
          {language === 'es' 
            ? 'Pase el cursor sobre la alerta para descartarla. Las alertas se actualizan en tiempo real.'
            : language === 'fr'
            ? 'Survolez l\'alerte pour la rejeter. Les alertes sont mises Ã  jour en temps rÃ©el.'
            : 'Hover over alert to dismiss. Alerts update in real-time.'}
        </p>
      </div>
    </div>
  );
}=== File: src/components/Navigation.tsx ===
// components/Navigation.tsx
'use client';

import { useAuth } from '../lib/AuthContext';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import {
  LayoutDashboard,
  Map,
  Building2,
  Users,
  Bell,
  FileText,
  Settings,
  LogOut,
  Menu,
  X,
  Shield,
  User,
} from 'lucide-react';
import { useState } from 'react';

export default function Navigation() {
  const { user, logout, hasPermission } = useAuth();
  const pathname = usePathname();
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  if (!user) {
    return null;
  }

  const navigation = [
    {
      name: 'Dashboard',
      href: '/dashboard',
      icon: LayoutDashboard,
      show: hasPermission('canAccessDashboard'),
    },
    {
      name: 'Map View',
      href: '/map',
      icon: Map,
      show: hasPermission('canViewMap'),
    },
    {
      name: 'Hospital Resources',
      href: '/hospital-resources',
      icon: Building2,
      show: hasPermission('canManageHospitals'),
    },
    {
      name: 'Resource Requests',
      href: '/resource-requests',
      icon: FileText,
      show: hasPermission('canManageHospitals'),
    },
    {
      name: 'Review Requests',
      href: '/resource-review',
      icon: Shield,
      show: hasPermission('canReviewRequests'),
    },
    {
      name: 'Responders',
      href: '/responder-management',
      icon: Users,
      show: hasPermission('canManageResponders'),
    },
    {
      name: 'Alerts',
      href: '/alerts',
      icon: Bell,
      show: hasPermission('canSendAlerts'),
    },
    {
    href: '/alerts-multilingual',
    icon: Bell,
    label: 'Emergency Alerts',
    roles: ['admin', 'dispatcher']
  },
  {
    href: '/hospitals',
    icon: Building2,
    label: 'Hospital Resources',
    roles: ['admin', 'dispatcher', 'hospital_worker']
  }
  ].filter((item) => item.show);

  const getRoleBadgeColor = (role: string) => {
    switch (role) {
      case 'admin':
        return 'bg-red-600';
      case 'dispatcher':
        return 'bg-yellow-600';
      case 'hospital_worker':
        return 'bg-emerald-600';
      case 'first_responder':
        return 'bg-purple-600';
      default:
        return 'bg-blue-600';
    }
  };

  const getRoleLabel = (role: string) => {
    switch (role) {
      case 'admin':
        return 'Administrator';
      case 'dispatcher':
        return 'Dispatcher';
      case 'hospital_worker':
        return 'Hospital Worker';
      case 'first_responder':
        return 'First Responder';
      default:
        return 'User';
    }
  };

  return (
    <>
      {/* Top Navigation Bar */}
      <nav className="bg-slate-800 border-b border-slate-700 sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16">
            {/* Logo and Title */}
            <div className="flex items-center">
              <Shield className="w-8 h-8 text-blue-500 mr-3" />
              <div>
                <h1 className="text-xl font-bold text-white">Crisis Management</h1>
                <p className="text-xs text-slate-400 hidden sm:block">Real-time Coordination</p>
              </div>
            </div>

            {/* Desktop Navigation */}
            <div className="hidden md:flex items-center space-x-4">
              {navigation.map((item) => {
                const Icon = item.icon;
                const isActive = pathname === item.href;
                return (
                  <Link
                    key={item.name}
                    href={item.href}
                    className={`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${
                      isActive
                        ? 'bg-blue-600 text-white'
                        : 'text-slate-300 hover:bg-slate-700 hover:text-white'
                    }`}
                  >
                    <Icon className="w-4 h-4" />
                    <span className="text-sm font-medium">{item.name}</span>
                  </Link>
                );
              })}
            </div>

            {/* User Menu */}
            <div className="flex items-center gap-3">
              {/* User Info */}
              <div className="hidden sm:block text-right">
                <p className="text-sm font-medium text-white">{user.name}</p>
                <div className="flex items-center justify-end gap-2">
                  <span
                    className={`text-xs px-2 py-0.5 rounded-full text-white ${getRoleBadgeColor(
                      user.role
                    )}`}
                  >
                    {getRoleLabel(user.role)}
                  </span>
                </div>
              </div>

              {/* Logout Button */}
              <button
                onClick={logout}
                className="flex items-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-sm font-medium"
              >
                <LogOut className="w-4 h-4" />
                <span className="hidden sm:inline">Logout</span>
              </button>

              {/* Mobile Menu Button */}
              <button
                onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                className="md:hidden p-2 rounded-lg text-slate-300 hover:bg-slate-700"
              >
                {mobileMenuOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
              </button>
            </div>
          </div>
        </div>

        {/* Mobile Navigation */}
        {mobileMenuOpen && (
          <div className="md:hidden border-t border-slate-700 bg-slate-800">
            <div className="px-4 py-3 space-y-2">
              {/* User Info on Mobile */}
              <div className="pb-3 mb-3 border-b border-slate-700">
                <div className="flex items-center gap-3">
                  <div className="bg-slate-700 p-2 rounded-full">
                    <User className="w-5 h-5 text-slate-300" />
                  </div>
                  <div>
                    <p className="text-sm font-medium text-white">{user.name}</p>
                    <span
                      className={`text-xs px-2 py-0.5 rounded-full text-white ${getRoleBadgeColor(
                        user.role
                      )}`}
                    >
                      {getRoleLabel(user.role)}
                    </span>
                  </div>
                </div>
              </div>

              {/* Mobile Nav Links */}
              {navigation.map((item) => {
                const Icon = item.icon;
                const isActive = pathname === item.href;
                return (
                  <Link
                    key={item.name}
                    href={item.href}
                    onClick={() => setMobileMenuOpen(false)}
                    className={`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${
                      isActive
                        ? 'bg-blue-600 text-white'
                        : 'text-slate-300 hover:bg-slate-700 hover:text-white'
                    }`}
                  >
                    <Icon className="w-5 h-5" />
                    <span className="font-medium">{item.name}</span>
                  </Link>
                );
              })}
            </div>
          </div>
        )}
      </nav>
    </>
  );
}=== File: src/components/ProtectedRoute.tsx ===
// components/ProtectedRoute.tsx
'use client';

import { useAuth } from '../lib/AuthContext';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';
import { Shield } from 'lucide-react';

interface ProtectedRouteProps {
  children: React.ReactNode;
  requiredPermissions?: string[];
  fallbackPath?: string;
}

export default function ProtectedRoute({
  children,
  requiredPermissions = [],
  fallbackPath = '/login',
}: ProtectedRouteProps) {
  const { user, loading, hasPermission } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading) {
      if (!user) {
        router.push(fallbackPath);
        return;
      }

      // Check required permissions
      if (requiredPermissions.length > 0) {
        const hasAllPermissions = requiredPermissions.every((permission) =>
          hasPermission(permission)
        );

        if (!hasAllPermissions) {
          router.push('/unauthorized');
        }
      }
    }
  }, [user, loading, router, requiredPermissions, fallbackPath, hasPermission]);

  if (loading) {
    return (
      <div className="min-h-screen bg-slate-900 flex items-center justify-center">
        <div className="text-center">
          <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"></div>
          <p className="text-white">Loading...</p>
        </div>
      </div>
    );
  }

  if (!user) {
    return null;
  }

  // Check permissions
  if (requiredPermissions.length > 0) {
    const hasAllPermissions = requiredPermissions.every((permission) =>
      hasPermission(permission)
    );

    if (!hasAllPermissions) {
      return (
        <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6">
          <div className="bg-slate-800 rounded-lg p-8 shadow-xl border border-slate-700 max-w-md w-full text-center">
            <Shield className="w-16 h-16 text-red-500 mx-auto mb-4" />
            <h1 className="text-2xl font-bold text-white mb-2">Access Denied</h1>
            <p className="text-slate-400 mb-6">
              You don't have permission to access this page.
            </p>
            <button
              onClick={() => router.push('/dashboard')}
              className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors"
            >
              Go to Dashboard
            </button>
          </div>
        </div>
      );
    }
  }

  return <>{children}</>;
}=== File: src/components/ResourceChart.tsx ===
'use client';

import React from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from 'recharts';
import { ResourceChartData } from '../lib/types';

interface ResourceChartProps {
  data: Array<{ name: string; value: number; status: string }>;
}

export default function ResourceChart({ data }: ResourceChartProps) {
  const COLORS: Record<string, string> = {
    available: '#10b981',
    'en-route': '#f59e0b',
    'on-scene': '#ef4444',
    standby: '#6366f1',
    active: '#f59e0b'
  };

  // Helper function with type safety
  const getColor = (status: string): string => {
    return COLORS[status] || '#6b7280'; // Fallback to gray
  };

  return (
    <div className="bg-slate-800 rounded-lg p-5 shadow-xl border border-slate-700">
      <h3 className="text-lg font-semibold mb-4">Resource Distribution</h3>
      <ResponsiveContainer width="100%" height={300}>
        <PieChart>
          <Pie
            data={data}
            cx="50%"
            cy="50%"
            labelLine={false}
            label={(entry) => `${entry.name}: ${entry.value}`}
            outerRadius={80}
            fill="#8884d8"
            dataKey="value"
          >
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={getColor(entry.status)} />
            ))}
          </Pie>
          <Tooltip />
          <Legend />
        </PieChart>
      </ResponsiveContainer>
    </div>
  );
}=== File: src/components/ResponderMap.tsx ===
'use client';

import { useEffect, useRef } from 'react';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';

// Fix Leaflet default icon (must be outside component)
delete (L.Icon.Default.prototype as any)._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
});

interface Coords {
  lat: number;
  lng: number;
}

interface Responder {
  id: string;
  name: string;
  type: string;
  status: string;
  location: string;
  coords?: Coords;
  route?: any;
}

interface DamageFeature {
  id: number;
  geometry: {
    type: string;
    coordinates: [number, number];
  };
  properties: {
    damageType: string;
    severity: number;
    slope?: number;
    area?: number;
    confidence?: number;
  };
}

interface DamageAnalysis {
  features: DamageFeature[];
}

interface ResponderMapProps {
  responders: Responder[];
  damageAnalysis?: DamageAnalysis | null;
  showDamageOverlays?: boolean;
}

export default function ResponderMap({ 
  responders, 
  damageAnalysis, 
  showDamageOverlays = false 
}: ResponderMapProps) {
  const mapRef = useRef<L.Map | null>(null);
  const mapContainerRef = useRef<HTMLDivElement>(null);
  const markersRef = useRef<L.Marker[]>([]);
  const overlaysRef = useRef<L.Circle[]>([]);

  // Initialize map
  useEffect(() => {
    if (typeof window === 'undefined' || !mapContainerRef.current) return;

    // Create map if it doesn't exist
    if (!mapRef.current) {
      const map = L.map(mapContainerRef.current).setView([33.7490, -84.3880], 11);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);

      // Create custom pane for damage overlays with lower z-index
      // Default Leaflet panes:
      // - mapPane: 0
      // - tilePane: 200
      // - overlayPane: 400 (default for overlays)
      // - shadowPane: 500
      // - markerPane: 600
      // - tooltipPane: 650
      // - popupPane: 700 (popups appear here)
      
      // Create damage overlay pane below popups but above tiles
      const damagePane = map.createPane('damageOverlayPane');
      damagePane.style.zIndex = '450'; // Between overlayPane (400) and shadowPane (500), below popupPane (700)

      mapRef.current = map;
    }

    return () => {
      // Cleanup on unmount
      if (mapRef.current) {
        mapRef.current.remove();
        mapRef.current = null;
      }
    };
  }, []);

  // Update responder markers
  useEffect(() => {
    if (!mapRef.current) return;

    // Clear existing markers
    markersRef.current.forEach(marker => marker.remove());
    markersRef.current = [];

    // Add new markers
    responders.forEach(responder => {
      if (responder.coords && mapRef.current) {
        const icon = L.divIcon({
          html: `
            <div style="
              background: ${responder.type === 'Fire' ? '#ea580c' : '#2563eb'};
              color: white;
              padding: 4px 8px;
              border-radius: 4px;
              font-weight: bold;
              font-size: 12px;
              white-space: nowrap;
              box-shadow: 0 2px 4px rgba(0,0,0,0.3);
              border: 2px solid white;
            ">
              ${responder.name}
            </div>
          `,
          className: 'custom-marker',
          iconSize: [0, 0],
          iconAnchor: [0, 0]
        });

        const marker = L.marker([responder.coords.lat, responder.coords.lng], { icon })
          .bindPopup(`
            <div style="font-family: sans-serif;">
              <strong style="font-size: 14px;">${responder.name}</strong><br/>
              <span style="color: #666;">Type: ${responder.type}</span><br/>
              <span style="color: #666;">Status: ${responder.status}</span><br/>
              <span style="color: #666;">Location: ${responder.location}</span>
            </div>
          `)
          .addTo(mapRef.current);

        markersRef.current.push(marker);
      }
    });
  }, [responders]);

  // Update damage overlays
  useEffect(() => {
    if (!mapRef.current) return;

    // Clear existing overlays
    overlaysRef.current.forEach(overlay => overlay.remove());
    overlaysRef.current = [];

    // Add damage overlays if enabled and data exists
    if (showDamageOverlays && damageAnalysis?.features) {
      damageAnalysis.features.forEach(feature => {
        if (mapRef.current && feature.geometry.type === 'Point') {
          const [lng, lat] = feature.geometry.coordinates;
          const { damageType, severity, area, confidence } = feature.properties;

          // Color based on damage type
          let color = '#ef4444'; // red default
          if (damageType === 'flood') color = '#3b82f6'; // blue
          if (damageType === 'collapse') color = '#f97316'; // orange
          if (damageType === 'debris') color = '#eab308'; // yellow
          if (damageType === 'fire') color = '#dc2626'; // dark red

          // Size based on severity and area
          const baseRadius = 50; // meters
          const severityMultiplier = severity / 10; // 0-1 scale
          const areaMultiplier = area ? Math.sqrt(area) / 20 : 1;
          const radius = baseRadius * severityMultiplier * areaMultiplier;

          // Opacity based on confidence
          const opacity = confidence ? 0.3 + (confidence * 0.4) : 0.5;

          // Create circle overlay
          const circle = L.circle([lat, lng], {
            color: color,
            fillColor: color,
            fillOpacity: opacity,
            radius: radius,
            weight: 2,
            pane: 'damageOverlayPane' // Use custom pane with z-index 450 (below popups at 700)
          })
            .bindPopup(`
              <div style="font-family: sans-serif;">
                <strong style="font-size: 14px; color: ${color};">âš ï¸ ${damageType.toUpperCase()}</strong><br/>
                <span style="color: #666;">Severity: ${severity.toFixed(1)}/10</span><br/>
                ${area ? `<span style="color: #666;">Area: ${area}mÂ²</span><br/>` : ''}
                ${confidence ? `<span style="color: #666;">Confidence: ${(confidence * 100).toFixed(0)}%</span>` : ''}
              </div>
            `)
            .addTo(mapRef.current);

          overlaysRef.current.push(circle);
        }
      });

      // Optionally fit bounds to show all overlays
      if (overlaysRef.current.length > 0 && mapRef.current) {
        const group = L.featureGroup(overlaysRef.current);
        mapRef.current.fitBounds(group.getBounds().pad(0.1));
      }
    }
  }, [damageAnalysis, showDamageOverlays]);

  return <div ref={mapContainerRef} style={{ height: '100%', width: '100%' }} />;
}=== File: src/components/StatusBadge.tsx ===
import React from 'react';
import { CheckCircle, Activity, AlertCircle, XCircle } from 'lucide-react';

interface StatusBadgeProps {
  status: string;
  size?: 'sm' | 'md' | 'lg';
}

export default function StatusBadge({ status, size = 'md' }: StatusBadgeProps) {
  const getStatusColor = (status: string) => {
    switch(status.toLowerCase()) {
      case 'available': 
      case 'standby': 
        return 'bg-green-500';
      case 'en-route': 
      case 'active': 
      case 'busy':
        return 'bg-yellow-500';
      case 'on-scene': 
        return 'bg-red-500';
      case 'offline':
      case 'unavailable':
        return 'bg-gray-500';
      default: 
        return 'bg-blue-500';
    }
  };

  const getStatusIcon = (status: string) => {
    const iconSize = size === 'sm' ? 'w-3 h-3' : size === 'lg' ? 'w-5 h-5' : 'w-4 h-4';
    
    switch(status.toLowerCase()) {
      case 'available': 
      case 'standby': 
        return <CheckCircle className={iconSize} />;
      case 'en-route': 
      case 'active': 
      case 'busy':
        return <Activity className={iconSize} />;
      case 'on-scene': 
        return <AlertCircle className={iconSize} />;
      default: 
        return <XCircle className={iconSize} />;
    }
  };

  const sizeClasses = {
    sm: 'px-2 py-0.5 text-xs',
    md: 'px-2 py-1 text-xs',
    lg: 'px-3 py-1.5 text-sm'
  };

  return (
    <div className={`flex items-center gap-1 ${getStatusColor(status)} ${sizeClasses[size]} rounded`}>
      {getStatusIcon(status)}
      <span className="capitalize font-medium">{status}</span>
    </div>
  );
}=== File: src/data/responders.json ===
[
  {
    "id": "FR-101",
    "status": "Available",
    "location": {
      "lat": 33.931118648736806,
      "lng": -84.33167731617658
    },
    "updatedAt": "2025-10-13T01:34:46.370Z"
  },
  {
    "id": "FR-102",
    "status": "active",
    "location": null,
    "updatedAt": "2025-10-12T23:57:42.833Z"
  },
  {
    "id": "FR-103",
    "status": "active",
    "location": {
      "lat": 33.931033508461965,
      "lng": -84.33166010798195
    },
    "updatedAt": "2025-10-13T01:24:31.445Z"
  },
  {
    "id": "FR-104",
    "status": "Available",
    "location": {
      "lat": 33.931096690470504,
      "lng": -84.3316843686623
    },
    "updatedAt": "2025-10-13T00:09:01.742Z"
  },
  {
    "id": "FR-101%20%3E%20ALLOW%20GEOLOCATION%20%3E%20WAIT%2030S%20%3E%20REFRESH%20DASHBOARD%20%3E",
    "status": "Available",
    "location": {
      "lat": 33.9310770137268,
      "lng": -84.33167540033794
    },
    "updatedAt": "2025-10-13T00:14:20.375Z"
  }
]
=== File: src/hooks/useRealTimeData.ts ===
'use client';

import { useState, useEffect } from 'react';
import io, { Socket } from 'socket.io-client';
import { DashboardData } from '../lib/types';

export const useRealTimeData = () => {
  const [socket, setSocket] = useState<Socket | null>(null);
  const [loading, setLoading] = useState(true);
  const [data, setData] = useState<DashboardData>({
    ambulances: [
      { id: 'AMB-001', status: 'available', location: 'Station 1', lastUpdate: '2 min ago' },
      { id: 'AMB-002', status: 'en-route', location: 'Main St & 5th Ave', lastUpdate: '30 sec ago' },
      { id: 'AMB-003', status: 'on-scene', location: 'City Park', lastUpdate: '1 min ago' },
      { id: 'AMB-004', status: 'available', location: 'Station 2', lastUpdate: '5 min ago' },
    ],
    hospitals: [
      { id: 'HSP-001', name: 'Central Medical', capacity: 85, available: 12, emergencyWait: '15 min' },
      { id: 'HSP-002', name: 'St. Mary\'s Hospital', capacity: 120, available: 8, emergencyWait: '22 min' },
      { id: 'HSP-003', name: 'Memorial Hospital', capacity: 95, available: 20, emergencyWait: '8 min' },
    ],
    firstResponders: [
      { id: 'FR-101', name: 'Unit Alpha', type: 'Fire', status: 'active', location: 'Downtown' },
      { id: 'FR-102', name: 'Unit Bravo', type: 'Police', status: 'active', location: 'North District' },
      { id: 'FR-103', name: 'Unit Charlie', type: 'Fire', status: 'standby', location: 'Station 3' },
      { id: 'FR-104', name: 'Unit Delta', type: 'Police', status: 'active', location: 'Highway 5' },
    ],
    timeline: [
      { id: 1, time: '14:32:15', event: 'Ambulance AMB-002 dispatched to Main St & 5th Ave', type: 'dispatch' },
      { id: 2, time: '14:30:08', event: '911 call received - Medical emergency reported', type: 'alert' },
      { id: 3, time: '14:28:45', event: 'Unit Alpha completed fire suppression', type: 'complete' },
      { id: 4, time: '14:25:12', event: 'Hospital capacity update - Memorial Hospital', type: 'update' },
    ],
    communications: [
      { id: 1, from: 'Dispatch', to: 'AMB-002', message: 'Proceeding to scene, ETA 4 minutes', time: '14:32:30' },
      { id: 2, from: 'Unit Alpha', to: 'Command', message: 'Fire under control, requesting medical support', time: '14:28:50' },
      { id: 3, from: 'Central Medical', to: 'Dispatch', message: 'ER bed available, standing by', time: '14:27:15' },
    ]
  });

  useEffect(() => {
    // Initialize socket connection
    const socketUrl = process.env.NEXT_PUBLIC_SOCKET_URL || 'http://localhost:3001';
    const socketInstance = io(socketUrl, {
      transports: ['websocket'],
      reconnectionAttempts: 5,
      reconnectionDelay: 1000,
    });
    
    socketInstance.on('connect', () => {
      console.log('âœ… Connected to real-time server');
      setLoading(false);
    });

    socketInstance.on('disconnect', () => {
      console.log('âŒ Disconnected from real-time server');
    });

    // Listen for ambulance updates
    socketInstance.on('update:ambulances', (ambulances) => {
      setData(prev => ({ ...prev, ambulances }));
    });

    // Listen for hospital updates
    socketInstance.on('update:hospitals', (hospitals) => {
      setData(prev => ({ ...prev, hospitals }));
    });

    // Listen for first responder updates
    socketInstance.on('update:responders', (firstResponders) => {
      setData(prev => ({ ...prev, firstResponders }));
    });

    // Listen for new timeline events
    socketInstance.on('new:event', (event) => {
      setData(prev => ({
        ...prev,
        timeline: [event, ...prev.timeline].slice(0, 50) // Keep last 50 events
      }));
    });

    // Listen for new communications
    socketInstance.on('new:communication', (comm) => {
      setData(prev => ({
        ...prev,
        communications: [comm, ...prev.communications].slice(0, 50)
      }));
    });

    // Error handling
    socketInstance.on('connect_error', (error) => {
      console.error('Connection error:', error);
      setLoading(false);
    });

    setSocket(socketInstance);

    // Cleanup on unmount
    return () => {
      socketInstance.disconnect();
    };
  }, []);

  return { data, socket, loading };
};=== File: src/lib/alertStore.ts ===
// lib/alertStore.ts
// Client-side storage for multilingual alerts

export interface Alert {
  id: number;
  type: string;
  severity: 'extreme' | 'severe' | 'moderate' | 'minor';
  message: string;
  area: string;
  issued: string;
  expires: string;
  agency: string;
  instructions?: string;
  affectedPopulation?: number;
}

const STORAGE_KEY = 'emergency_alerts';
const DISMISSED_KEY = 'dismissed_alerts';
let listeners: Array<(alerts: Alert[]) => void> = [];

// Get all active alerts
export function getAlerts(): Alert[] {
  if (typeof window === 'undefined') return [];
  
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) {
      const alerts = JSON.parse(stored);
      // Filter out expired alerts
      const now = new Date().getTime();
      return alerts.filter((alert: Alert) => new Date(alert.expires).getTime() > now);
    }
  } catch (e) {
    console.error('Error loading alerts:', e);
  }
  
  return [];
}

// Get dismissed alert IDs
function getDismissedAlertIds(): number[] {
  if (typeof window === 'undefined') return [];
  
  try {
    const stored = localStorage.getItem(DISMISSED_KEY);
    return stored ? JSON.parse(stored) : [];
  } catch (e) {
    console.error('Error loading dismissed alerts:', e);
    return [];
  }
}

// Save dismissed alert IDs
function saveDismissedAlertIds(ids: number[]): void {
  if (typeof window === 'undefined') return;
  
  try {
    localStorage.setItem(DISMISSED_KEY, JSON.stringify(ids));
  } catch (e) {
    console.error('Error saving dismissed alerts:', e);
  }
}

// Get active (non-dismissed) alerts
export function getActiveAlerts(): Alert[] {
  const allAlerts = getAlerts();
  const dismissedIds = getDismissedAlertIds();
  return allAlerts.filter(alert => !dismissedIds.includes(alert.id));
}

// Save alerts
function saveAlerts(alerts: Alert[]): void {
  if (typeof window === 'undefined') return;
  
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(alerts));
    notifyListeners(alerts);
  } catch (e) {
    console.error('Error saving alerts:', e);
  }
}

// Add a new alert
export function addAlert(alert: Omit<Alert, 'id'>): Alert {
  const alerts = getAlerts();
  
  // Generate unique ID using timestamp + random string
  const newAlert: Alert = {
    ...alert,
    id: Date.now() + Math.floor(Math.random() * 10000),
  };
  
  alerts.unshift(newAlert);
  saveAlerts(alerts);
  
  return newAlert;
}

// Dismiss an alert (doesn't delete, just marks as dismissed)
export function dismissAlert(alertId: number): void {
  const dismissedIds = getDismissedAlertIds();
  
  if (!dismissedIds.includes(alertId)) {
    dismissedIds.push(alertId);
    saveDismissedAlertIds(dismissedIds);
    
    // Notify listeners with updated active alerts
    notifyListeners(getAlerts());
  }
}

// Clear all dismissed alerts (show them again)
export function clearDismissedAlerts(): void {
  if (typeof window === 'undefined') return;
  localStorage.removeItem(DISMISSED_KEY);
  notifyListeners(getAlerts());
}

// Delete an alert permanently
export function deleteAlert(alertId: number): void {
  const alerts = getAlerts();
  const filtered = alerts.filter(a => a.id !== alertId);
  saveAlerts(filtered);
}

// Subscribe to alert changes
export function onAlertsChange(callback: (alerts: Alert[]) => void): () => void {
  listeners.push(callback);
  
  return () => {
    listeners = listeners.filter(l => l !== callback);
  };
}

// Notify all listeners
function notifyListeners(alerts: Alert[]): void {
  listeners.forEach(callback => callback(alerts));
}

// Clear all alerts
export function clearAllAlerts(): void {
  if (typeof window === 'undefined') return;
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem(DISMISSED_KEY);
  notifyListeners([]);
}

// Initialize with sample alerts if empty (for demo)
export function initializeSampleAlerts(): void {
  const existing = getAlerts();
  if (existing.length === 0) {
    addAlert({
      type: 'flood',
      severity: 'severe',
      message: 'Flash flood warning in effect. Avoid low-lying areas immediately.',
      area: 'Downtown and surrounding areas',
      issued: new Date().toISOString(),
      expires: new Date(Date.now() + 7200000).toISOString(), // 2 hours
      agency: 'National Weather Service',
      instructions: 'Seek higher ground immediately. Do not attempt to drive through flooded areas.',
      affectedPopulation: 25000
    });
  }
}=== File: src/lib/api.ts ===
=== File: src/lib/auth.ts ===
// lib/auth.ts
// Authentication utilities and helpers

import { randomBytes } from 'crypto';
import bcrypt from 'bcryptjs';
import { userQueries, sessionQueries, activityQueries } from './db';

export interface User {
  id: number;
  username: string;
  role: 'admin' | 'dispatcher' | 'hospital_worker' | 'first_responder' | 'user';
  name: string;
  email: string;
  phone?: string;
  organization?: string;
  created_at: string;
  last_login?: string;
}

export interface Session {
  id: number;
  user_id: number;
  token: string;
  expires_at: string;
  created_at: string;
}

// Role permissions configuration
export const ROLE_PERMISSIONS = {
  admin: {
    canAccessDashboard: true,
    canManageHospitals: true,
    canManageResponders: true,
    canManageUsers: true,
    canViewMap: true,
    canViewReports: true,
    canSendAlerts: true,
    canReviewRequests: true,
  },
  dispatcher: {
    canAccessDashboard: true,
    canManageHospitals: false,
    canManageResponders: true,
    canManageUsers: false,
    canViewMap: true,
    canViewReports: true,
    canSendAlerts: true,
    canReviewRequests: true,
  },
  hospital_worker: {
    canAccessDashboard: true,
    canManageHospitals: true,
    canManageResponders: false,
    canManageUsers: false,
    canViewMap: false,
    canViewReports: false,
    canSendAlerts: false,
    canReviewRequests: false,
  },
  first_responder: {
    canAccessDashboard: true,
    canManageHospitals: false,
    canManageResponders: false,
    canManageUsers: false,
    canViewMap: true,
    canViewReports: false,
    canSendAlerts: false,
    canReviewRequests: false,
  },
  user: {
    canAccessDashboard: true,
    canManageHospitals: false,
    canManageResponders: false,
    canManageUsers: false,
    canViewMap: false,
    canViewReports: false,
    canSendAlerts: false,
    canReviewRequests: false,
  },
};

// Generate a secure session token
export function generateSessionToken(): string {
  return randomBytes(32).toString('hex');
}

// Hash password
export function hashPassword(password: string): string {
  return bcrypt.hashSync(password, 10);
}

// Verify password
export function verifyPassword(password: string, hash: string): boolean {
  return bcrypt.compareSync(password, hash);
}

// Authenticate user
export function authenticateUser(username: string, password: string): User | null {
  const row: any = userQueries.findByUsername.get(username);
  
  if (!row) {
    return null;
  }
  
  if (!verifyPassword(password, row.password_hash)) {
    return null;
  }
  
  // Update last login
  userQueries.updateLastLogin.run(row.id);
  
  // Remove password hash from returned user
  const { password_hash, ...user } = row;
  return user as User;
}

// Create session
export function createSession(userId: number): string {
  const token = generateSessionToken();
  const expiresAt = new Date();
  expiresAt.setDate(expiresAt.getDate() + 7); // 7 days
  
  sessionQueries.create.run(userId, token, expiresAt.toISOString());
  
  return token;
}

// Validate session
export function validateSession(token: string): User | null {
  if (!token) {
    return null;
  }
  
  const session: any = sessionQueries.findByToken.get(token);
  
  if (!session) {
    return null;
  }
  
  const user: any = userQueries.findById.get(session.user_id);
  
  if (!user) {
    return null;
  }
  
  const { password_hash, ...userWithoutPassword } = user;
  return userWithoutPassword as User;
}

// Delete session (logout)
export function deleteSession(token: string): void {
  sessionQueries.deleteByToken.run(token);
}

// Delete all sessions for a user
export function deleteUserSessions(userId: number): void {
  sessionQueries.deleteByUserId.run(userId);
}

// Log activity
export function logActivity(
  userId: number | null,
  action: string,
  details?: string,
  ipAddress?: string
): void {
  activityQueries.create.run(userId, action, details || null, ipAddress || null);
}

// Check if user has permission
export function hasPermission(
  user: User | null,
  permission: keyof typeof ROLE_PERMISSIONS.admin
): boolean {
  if (!user) {
    return false;
  }
  
  const rolePermissions = ROLE_PERMISSIONS[user.role];
  return rolePermissions[permission] || false;
}

// Get user by ID
export function getUserById(id: number): User | null {
  const row: any = userQueries.findById.get(id);
  if (!row) {
    return null;
  }
  const { password_hash, ...user } = row;
  return user as User;
}

// Get all users
export function getAllUsers(): User[] {
  const rows: any[] = userQueries.getAll.all();
  return rows;
}

// Create new user
export function createUser(userData: {
  username: string;
  password: string;
  role: User['role'];
  name: string;
  email: string;
  phone?: string;
  organization?: string;
}): number {
  const passwordHash = hashPassword(userData.password);
  const result = userQueries.create.run(
    userData.username,
    passwordHash,
    userData.role,
    userData.name,
    userData.email,
    userData.phone || null,
    userData.organization || null
  );
  return result.lastInsertRowid as number;
}=== File: src/lib/AuthContext.tsx ===
// lib/AuthContext.tsx
'use client';

import React, { createContext, useContext, useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';

export interface User {
  id: number;
  username: string;
  role: 'admin' | 'dispatcher' | 'hospital_worker' | 'first_responder' | 'user';
  name: string;
  email: string;
  organization?: string;
}

interface AuthContextType {
  user: User | null;
  loading: boolean;
  login: (username: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
  checkSession: () => Promise<void>;
  hasPermission: (permission: string) => boolean;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const router = useRouter();

  // Role permissions configuration
  const ROLE_PERMISSIONS = {
    admin: {
      canAccessDashboard: true,
      canManageHospitals: true,
      canManageResponders: true,
      canManageUsers: true,
      canViewMap: true,
      canViewReports: true,
      canSendAlerts: true,
      canReviewRequests: true,
    },
    dispatcher: {
      canAccessDashboard: true,
      canManageHospitals: false,
      canManageResponders: true,
      canManageUsers: false,
      canViewMap: true,
      canViewReports: true,
      canSendAlerts: true,
      canReviewRequests: true,
    },
    hospital_worker: {
      canAccessDashboard: true,
      canManageHospitals: true,
      canManageResponders: false,
      canManageUsers: false,
      canViewMap: false,
      canViewReports: false,
      canSendAlerts: false,
      canReviewRequests: false,
    },
    first_responder: {
      canAccessDashboard: true,
      canManageHospitals: false,
      canManageResponders: false,
      canManageUsers: false,
      canViewMap: true,
      canViewReports: false,
      canSendAlerts: false,
      canReviewRequests: false,
    },
    user: {
      canAccessDashboard: true,
      canManageHospitals: false,
      canManageResponders: false,
      canManageUsers: false,
      canViewMap: false,
      canViewReports: false,
      canSendAlerts: false,
      canReviewRequests: false,
    },
  };

  // Check session on mount
  useEffect(() => {
    checkSession();
  }, []);

  const checkSession = async () => {
    try {
      const response = await fetch('/api/auth/session');
      
      if (response.ok) {
        const data = await response.json();
        setUser(data.user);
      } else {
        setUser(null);
      }
    } catch (error) {
      console.error('Session check error:', error);
      setUser(null);
    } finally {
      setLoading(false);
    }
  };

  const login = async (username: string, password: string) => {
    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ username, password }),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Login failed');
      }

      const data = await response.json();
      setUser(data.user);
      router.push('/dashboard');
    } catch (error) {
      console.error('Login error:', error);
      throw error;
    }
  };

  const logout = async () => {
    try {
      await fetch('/api/auth/logout', {
        method: 'POST',
      });
      
      setUser(null);
      router.push('/login');
    } catch (error) {
      console.error('Logout error:', error);
    }
  };

  const hasPermission = (permission: string): boolean => {
    if (!user) {
      return false;
    }
    
    const rolePermissions = ROLE_PERMISSIONS[user.role];
    return (rolePermissions as any)[permission] || false;
  };

  return (
    <AuthContext.Provider value={{ user, loading, login, logout, checkSession, hasPermission }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}=== File: src/lib/db.ts ===
// lib/db.ts
// SQLite database setup and utilities

import Database from 'better-sqlite3';
import path from 'path';
import fs from 'fs';
import bcrypt from 'bcryptjs';

const dbPath = path.join(process.cwd(), 'data', 'crisis-management.db');

// Ensure data directory exists
const dataDir = path.dirname(dbPath);
if (!fs.existsSync(dataDir)) {
  fs.mkdirSync(dataDir, { recursive: true });
}

// Initialize database
const db = new Database(dbPath);

// Enable foreign keys
db.pragma('foreign_keys = ON');

// Create tables
export function initializeDatabase() {
  // Users table
  db.exec(`
    CREATE TABLE IF NOT EXISTS users (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      username TEXT UNIQUE NOT NULL,
      password_hash TEXT NOT NULL,
      role TEXT NOT NULL CHECK(role IN ('admin', 'dispatcher', 'hospital_worker', 'first_responder', 'user')),
      name TEXT NOT NULL,
      email TEXT UNIQUE NOT NULL,
      phone TEXT,
      organization TEXT,
      is_active INTEGER DEFAULT 1,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      last_login DATETIME
    )
  `);

  // Sessions table
  db.exec(`
    CREATE TABLE IF NOT EXISTS sessions (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      user_id INTEGER NOT NULL,
      token TEXT UNIQUE NOT NULL,
      expires_at DATETIME NOT NULL,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    )
  `);

  // Activity log table
  db.exec(`
    CREATE TABLE IF NOT EXISTS activity_log (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      user_id INTEGER,
      action TEXT NOT NULL,
      details TEXT,
      ip_address TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
    )
  `);

  // Create indexes
  db.exec(`
    CREATE INDEX IF NOT EXISTS idx_users_username ON users(username);
    CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
    CREATE INDEX IF NOT EXISTS idx_sessions_token ON sessions(token);
    CREATE INDEX IF NOT EXISTS idx_sessions_user_id ON sessions(user_id);
  `);

  console.log('âœ… Database tables initialized');
}

// Seed sample users
export function seedSampleUsers() {
  const users = [
    {
      username: 'admin',
      password: 'admin123',
      role: 'admin',
      name: 'System Administrator',
      email: 'admin@crisis-mgmt.local',
      phone: '555-0100',
      organization: 'Crisis Management HQ'
    },
    {
      username: 'dispatcher1',
      password: 'dispatch123',
      role: 'dispatcher',
      name: 'Sarah Johnson',
      email: 'sarah.j@dispatch.local',
      phone: '555-0101',
      organization: 'Central Dispatch'
    },
    {
      username: 'hospital1',
      password: 'hospital123',
      role: 'hospital_worker',
      name: 'Dr. Michael Chen',
      email: 'mchen@central-medical.local',
      phone: '555-0102',
      organization: 'Central Medical Center'
    },
    {
      username: 'responder1',
      password: 'respond123',
      role: 'first_responder',
      name: 'Officer James Martinez',
      email: 'jmartinez@firstresponse.local',
      phone: '555-0103',
      organization: 'Fire Department Unit Alpha'
    },
    {
      username: 'user1',
      password: 'user123',
      role: 'user',
      name: 'Emily Rodriguez',
      email: 'emily.r@example.com',
      phone: '555-0104',
      organization: null
    }
  ];

  const insert = db.prepare(`
    INSERT OR IGNORE INTO users (username, password_hash, role, name, email, phone, organization)
    VALUES (?, ?, ?, ?, ?, ?, ?)
  `);

  users.forEach(user => {
    const passwordHash = bcrypt.hashSync(user.password, 10);
    insert.run(
      user.username,
      passwordHash,
      user.role,
      user.name,
      user.email,
      user.phone,
      user.organization
    );
  });

  console.log('âœ… Sample users seeded');
}

// Initialize database FIRST, before creating prepared statements
initializeDatabase();
seedSampleUsers();

// NOW create prepared statements AFTER tables exist
export const userQueries = {
  findByUsername: db.prepare('SELECT * FROM users WHERE username = ? AND is_active = 1'),
  findById: db.prepare('SELECT * FROM users WHERE id = ? AND is_active = 1'),
  findByEmail: db.prepare('SELECT * FROM users WHERE email = ? AND is_active = 1'),
  create: db.prepare(`
    INSERT INTO users (username, password_hash, role, name, email, phone, organization)
    VALUES (?, ?, ?, ?, ?, ?, ?)
  `),
  updateLastLogin: db.prepare('UPDATE users SET last_login = CURRENT_TIMESTAMP WHERE id = ?'),
  getAllByRole: db.prepare('SELECT * FROM users WHERE role = ? AND is_active = 1'),
  getAll: db.prepare('SELECT id, username, role, name, email, phone, organization, created_at, last_login FROM users WHERE is_active = 1')
};

// Session queries
export const sessionQueries = {
  create: db.prepare('INSERT INTO sessions (user_id, token, expires_at) VALUES (?, ?, ?)'),
  findByToken: db.prepare('SELECT * FROM sessions WHERE token = ? AND expires_at > CURRENT_TIMESTAMP'),
  deleteByToken: db.prepare('DELETE FROM sessions WHERE token = ?'),
  deleteExpired: db.prepare('DELETE FROM sessions WHERE expires_at <= CURRENT_TIMESTAMP'),
  deleteByUserId: db.prepare('DELETE FROM sessions WHERE user_id = ?')
};

// Activity log queries
export const activityQueries = {
  create: db.prepare('INSERT INTO activity_log (user_id, action, details, ip_address) VALUES (?, ?, ?, ?)'),
  getByUserId: db.prepare('SELECT * FROM activity_log WHERE user_id = ? ORDER BY created_at DESC LIMIT ?'),
  getRecent: db.prepare('SELECT * FROM activity_log ORDER BY created_at DESC LIMIT ?')
};

// Cleanup function
export function cleanupExpiredSessions() {
  const result = sessionQueries.deleteExpired.run();
  console.log(`ðŸ§¹ Cleaned up ${result.changes} expired sessions`);
  return result.changes;
}

export default db;=== File: src/lib/droneService.ts ===
// lib/droneService.ts
// Mock drone service for simulating drone reconnaissance missions

export interface DroneImage {
  id: string;
  url: string;
  gps: {
    lat: number;
    lon: number;
  };
  altitude: number;
  timestamp: string;
  processed: boolean;
}

export interface DamageFeature {
  type: string;
  geometry: {
    type: string;
    coordinates: number[];
  };
  properties: {
    damageType: 'flood' | 'collapse' | 'debris' | 'fire';
    severity: number; // 0-10
    slope?: number;
    area?: number;
  };
}

export interface DamageAnalysis {
  type: 'FeatureCollection';
  features: DamageFeature[];
  metadata: {
    missionId: string;
    analyzedAt: string;
    totalFeatures: number;
  };
}

export interface DroneModel {
  missionId: string;
  modelUrl: string;
  generatedAt: string;
  accuracy: {
    rmse: number; // Root Mean Square Error in meters
  };
  status: 'processing' | 'ready' | 'error';
}

// Simulate drone image upload (mock)
export async function simulateDroneUpload(missionId: string = 'demo-mission'): Promise<DroneImage[]> {
  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, 2000));

  const mockImages: DroneImage[] = Array.from({ length: 5 }, (_, i) => ({
    id: `IMG-${missionId}-${i + 1}`,
    url: `/uploads/drone/proc-img${i + 1}.jpg`,
    gps: {
      lat: 33.7490 + (Math.random() - 0.5) * 0.02,
      lon: -84.3880 + (Math.random() - 0.5) * 0.02,
    },
    altitude: 100 + Math.random() * 50,
    timestamp: new Date().toISOString(),
    processed: true,
  }));

  console.log('Mock drone upload complete:', mockImages.length, 'images');
  return mockImages;
}

// Generate 3D model from drone images (mock)
export async function generate3DModel(missionId: string = 'demo-mission'): Promise<DroneModel> {
  // Simulate processing delay (10-30 seconds in real scenario)
  await new Promise(resolve => setTimeout(resolve, 3000));

  const model: DroneModel = {
    missionId,
    modelUrl: `/models/${missionId}/base-terrain.gltf`,
    generatedAt: new Date().toISOString(),
    accuracy: {
      rmse: 1.5 + Math.random() * 2, // 1.5-3.5m accuracy
    },
    status: 'ready',
  };

  console.log('3D model generated:', model);
  return model;
}

// Analyze terrain for damage (mock)
export async function analyzeTerrain(missionId: string = 'demo-mission'): Promise<DamageAnalysis> {
  // Simulate analysis delay
  await new Promise(resolve => setTimeout(resolve, 2000));

  const damageTypes: Array<'flood' | 'collapse' | 'debris' | 'fire'> = ['flood', 'collapse', 'debris', 'fire'];
  
  const features: DamageFeature[] = Array.from({ length: 8 + Math.floor(Math.random() * 5) }, (_, i) => {
    const baseLat = 33.7490;
    const baseLon = -84.3880;
    
    return {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [
          baseLon + (Math.random() - 0.5) * 0.01,
          baseLat + (Math.random() - 0.5) * 0.01,
        ],
      },
      properties: {
        damageType: damageTypes[Math.floor(Math.random() * damageTypes.length)],
        severity: Math.random() * 10,
        slope: 0.3 + Math.random() * 0.4,
        area: 10 + Math.random() * 90, // square meters
      },
    };
  });

  const analysis: DamageAnalysis = {
    type: 'FeatureCollection',
    features,
    metadata: {
      missionId,
      analyzedAt: new Date().toISOString(),
      totalFeatures: features.length,
    },
  };

  console.log('Terrain analysis complete:', analysis.metadata);
  return analysis;
}

// Full drone reconnaissance workflow
export async function runDroneReconnaissance(
  missionId: string = 'demo-mission',
  onProgress?: (status: string, progress: number) => void
): Promise<{
  images: DroneImage[];
  model: DroneModel;
  analysis: DamageAnalysis;
}> {
  try {
    // Step 1: Upload/Process Images
    if (onProgress) onProgress('uploading', 0);
    const images = await simulateDroneUpload(missionId);
    
    // Step 2: Generate 3D Model
    if (onProgress) onProgress('generating', 33);
    const model = await generate3DModel(missionId);
    
    // Step 3: Analyze Terrain
    if (onProgress) onProgress('analyzing', 66);
    const analysis = await analyzeTerrain(missionId);
    
    if (onProgress) onProgress('ready', 100);
    
    return { images, model, analysis };
  } catch (error) {
    console.error('Drone reconnaissance error:', error);
    throw error;
  }
}

// Get damage summary statistics
export function getDamageSummary(analysis: DamageAnalysis) {
  const features = analysis.features;
  
  const highSeverity = features.filter(f => f.properties.severity > 7).length;
  const mediumSeverity = features.filter(f => f.properties.severity > 4 && f.properties.severity <= 7).length;
  const lowSeverity = features.filter(f => f.properties.severity <= 4).length;
  
  const byType = features.reduce((acc, f) => {
    const type = f.properties.damageType;
    acc[type] = (acc[type] || 0) + 1;
    return acc;
  }, {} as Record<string, number>);
  
  return {
    total: features.length,
    highSeverity,
    mediumSeverity,
    lowSeverity,
    byType,
    averageSeverity: features.reduce((sum, f) => sum + f.properties.severity, 0) / features.length,
  };
}

// Create a simple mock 3D model file (for testing)
export function createMockGLTF(): string {
  const mockGLTF = {
    asset: {
      version: '2.0',
      generator: 'Mock Drone Service',
    },
    scene: 0,
    scenes: [
      {
        nodes: [0],
      },
    ],
    nodes: [
      {
        mesh: 0,
      },
    ],
    meshes: [
      {
        primitives: [
          {
            attributes: {
              POSITION: 0,
            },
            mode: 4, // TRIANGLES
          },
        ],
      },
    ],
    accessors: [
      {
        bufferView: 0,
        componentType: 5126, // FLOAT
        count: 3,
        type: 'VEC3',
        max: [1, 1, 1],
        min: [-1, -1, -1],
      },
    ],
    bufferViews: [
      {
        buffer: 0,
        byteLength: 36,
        target: 34962, // ARRAY_BUFFER
      },
    ],
    buffers: [
      {
        byteLength: 36,
      },
    ],
  };

  return JSON.stringify(mockGLTF, null, 2);
}=== File: src/lib/hospitalDataStore.ts ===
// lib/hospitalDataStore.ts
// Client-side storage for hospital resource data

export interface HospitalData {
  id?: string;
  name: string;
  hospitalName?: string; // alias for compatibility
  totalBeds: number;
  availableBeds: number;
  availableICU: number;
  ventilators: number;
  lastUpdated: string;
}

const STORAGE_KEY = 'hospital_data';
let listeners: Array<(data: HospitalData[]) => void> = [];

// Initialize with default data if empty
const defaultHospitals: HospitalData[] = [
  {
    id: 'HSP-001',
    name: 'Central Medical',
    totalBeds: 85,
    availableBeds: 12,
    availableICU: 5,
    ventilators: 8,
    lastUpdated: new Date().toISOString(),
  },
  {
    id: 'HSP-002',
    name: "St. Mary's Hospital",
    totalBeds: 120,
    availableBeds: 8,
    availableICU: 3,
    ventilators: 5,
    lastUpdated: new Date().toISOString(),
  },
  {
    id: 'HSP-003',
    name: 'Memorial Hospital',
    totalBeds: 95,
    availableBeds: 20,
    availableICU: 8,
    ventilators: 12,
    lastUpdated: new Date().toISOString(),
  },
];

// Get hospital data from localStorage
export function getHospitalData(): HospitalData[] {
  if (typeof window === 'undefined') return defaultHospitals;
  
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) {
      const parsed = JSON.parse(stored);
      // Add IDs if missing
      return parsed.map((h: HospitalData, idx: number) => ({
        ...h,
        id: h.id || `HSP-${String(idx + 1).padStart(3, '0')}`,
        hospitalName: h.hospitalName || h.name, // compatibility
      }));
    }
  } catch (e) {
    console.error('Error loading hospital data:', e);
  }
  
  // Initialize with defaults
  saveHospitalData(defaultHospitals);
  return defaultHospitals;
}

// Save hospital data to localStorage
export function saveHospitalData(data: HospitalData[]): void {
  if (typeof window === 'undefined') return;
  
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    notifyListeners(data);
  } catch (e) {
    console.error('Error saving hospital data:', e);
  }
}

// Subscribe to hospital data changes
export function onHospitalDataChange(callback: (data: HospitalData[]) => void): () => void {
  listeners.push(callback);
  
  // Return unsubscribe function
  return () => {
    listeners = listeners.filter((l) => l !== callback);
  };
}

// Notify all listeners of data change
function notifyListeners(data: HospitalData[]): void {
  listeners.forEach((callback) => callback(data));
}

// Update a specific hospital
export function updateHospital(hospitalName: string, updates: Partial<HospitalData>): void {
  const hospitals = getHospitalData();
  const index = hospitals.findIndex(
    (h) => h.name.toLowerCase() === hospitalName.toLowerCase()
  );
  
  if (index !== -1) {
    hospitals[index] = {
      ...hospitals[index],
      ...updates,
      lastUpdated: new Date().toISOString(),
    };
    saveHospitalData(hospitals);
  }
}

// Clear all hospital data (useful for testing)
export function clearHospitalData(): void {
  if (typeof window === 'undefined') return;
  localStorage.removeItem(STORAGE_KEY);
  notifyListeners([]);
}=== File: src/lib/performance.ts ===
=== File: src/lib/resourceRequestStore.ts ===
// lib/resourceRequestStore.ts
// Client-side storage for resource requests

export interface ResourceRequest {
  id: string;
  hospitalName: string;
  resourceType: string;
  quantity: number;
  priority: string;
  status: 'pending' | 'approved' | 'denied';
  timestamp: string;
}

const STORAGE_KEY = 'resource_requests';
let listeners: Array<(data: ResourceRequest[]) => void> = [];

// Get all resource requests
export function getResourceRequests(): ResourceRequest[] {
  if (typeof window === 'undefined') return [];
  
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    return stored ? JSON.parse(stored) : [];
  } catch (e) {
    console.error('Error loading resource requests:', e);
    return [];
  }
}

// Save resource requests to localStorage
function saveResourceRequests(requests: ResourceRequest[]): void {
  if (typeof window === 'undefined') return;
  
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(requests));
    notifyListeners(requests);
  } catch (e) {
    console.error('Error saving resource requests:', e);
  }
}

// Add a new resource request
export function addResourceRequest(
  request: Omit<ResourceRequest, 'id' | 'status' | 'timestamp'>
): void {
  const requests = getResourceRequests();
  
  const newRequest: ResourceRequest = {
    ...request,
    id: `REQ-${Date.now()}`,
    status: 'pending',
    timestamp: new Date().toISOString(),
  };
  
  requests.push(newRequest);
  saveResourceRequests(requests);
}

// Approve a resource request
export function approveResourceRequest(id: string): void {
  const requests = getResourceRequests();
  const index = requests.findIndex((r) => r.id === id);
  
  if (index !== -1) {
    requests[index].status = 'approved';
    
    // Update hospital data with approved resources
    const request = requests[index];
    updateHospitalResources(request);
    
    // Remove from pending requests
    requests.splice(index, 1);
    saveResourceRequests(requests);
  }
}

// Deny a resource request
export function denyResourceRequest(id: string): void {
  const requests = getResourceRequests();
  const index = requests.findIndex((r) => r.id === id);
  
  if (index !== -1) {
    requests[index].status = 'denied';
    
    // Remove from pending requests
    requests.splice(index, 1);
    saveResourceRequests(requests);
  }
}

// Update hospital resources when request is approved
function updateHospitalResources(request: ResourceRequest): void {
  // Import dynamically to avoid circular dependency
  if (typeof window === 'undefined') return;
  
  try {
    const { getHospitalData, saveHospitalData } = require('./hospitalDataStore');
    const hospitals = getHospitalData();
    
    const hospitalIndex = hospitals.findIndex(
      (h: any) => h.name === request.hospitalName || h.hospitalName === request.hospitalName
    );
    
    if (hospitalIndex !== -1) {
      const hospital = hospitals[hospitalIndex];
      
      // Map resource type to hospital field
      const resourceMap: Record<string, string> = {
        'Beds': 'availableBeds',
        'beds': 'availableBeds',
        'ICU': 'availableICU',
        'icu': 'availableICU',
        'Ventilators': 'ventilators',
        'ventilators': 'ventilators',
      };
      
      const fieldName = resourceMap[request.resourceType] || request.resourceType;
      
      if (fieldName in hospital) {
        hospital[fieldName] = (hospital[fieldName] || 0) + request.quantity;
        hospital.lastUpdated = new Date().toISOString();
        saveHospitalData(hospitals);
      }
    }
  } catch (e) {
    console.error('Error updating hospital resources:', e);
  }
}

// Subscribe to request data changes
export function onRequestDataChange(callback: (data: ResourceRequest[]) => void): () => void {
  listeners.push(callback);
  
  // Return unsubscribe function
  return () => {
    listeners = listeners.filter((l) => l !== callback);
  };
}

// Notify all listeners of data change
function notifyListeners(data: ResourceRequest[]): void {
  listeners.forEach((callback) => callback(data));
}

// Clear all requests (useful for testing)
export function clearResourceRequests(): void {
  if (typeof window === 'undefined') return;
  localStorage.removeItem(STORAGE_KEY);
  notifyListeners([]);
}=== File: src/lib/socket.ts ===
=== File: src/lib/translationService.ts ===
// lib/translationService.ts
// Emergency Alert Translation Service - Spanish and French

export type Language = 'en' | 'es' | 'fr';

export interface TranslatedAlert {
  en: string;
  es: string;
  fr: string;
}

// Alert type translations
export const alertTypeTranslations: Record<string, TranslatedAlert> = {
  earthquake: {
    en: 'Earthquake',
    es: 'Terremoto',
    fr: 'Tremblement de terre'
  },
  flood: {
    en: 'Flood',
    es: 'InundaciÃ³n',
    fr: 'Inondation'
  },
  fire: {
    en: 'Fire',
    es: 'Incendio',
    fr: 'Incendie'
  },
  hurricane: {
    en: 'Hurricane',
    es: 'HuracÃ¡n',
    fr: 'Ouragan'
  },
  tornado: {
    en: 'Tornado',
    es: 'Tornado',
    fr: 'Tornade'
  },
  amber: {
    en: 'AMBER Alert',
    es: 'Alerta AMBER',
    fr: 'Alerte AMBER'
  },
  silver: {
    en: 'Silver Alert',
    es: 'Alerta Plateada',
    fr: 'Alerte argentÃ©e'
  },
  other: {
    en: 'Emergency Alert',
    es: 'Alerta de Emergencia',
    fr: 'Alerte d\'urgence'
  }
};

// Severity level translations
export const severityTranslations: Record<string, TranslatedAlert> = {
  extreme: {
    en: 'Extreme',
    es: 'Extremo',
    fr: 'ExtrÃªme'
  },
  severe: {
    en: 'Severe',
    es: 'Severo',
    fr: 'Grave'
  },
  moderate: {
    en: 'Moderate',
    es: 'Moderado',
    fr: 'ModÃ©rÃ©'
  },
  minor: {
    en: 'Minor',
    es: 'Menor',
    fr: 'Mineur'
  }
};

// Common alert phrases
export const alertPhrases: Record<string, TranslatedAlert> = {
  issued: {
    en: 'Issued',
    es: 'Emitido',
    fr: 'Ã‰mis'
  },
  expires: {
    en: 'Expires',
    es: 'Expira',
    fr: 'Expire'
  },
  affectedArea: {
    en: 'Affected Area',
    es: 'Ãrea Afectada',
    fr: 'Zone touchÃ©e'
  },
  instructions: {
    en: 'Instructions',
    es: 'Instrucciones',
    fr: 'Instructions'
  },
  seekShelter: {
    en: 'Seek shelter immediately',
    es: 'Busque refugio inmediatamente',
    fr: 'Cherchez un abri immÃ©diatement'
  },
  evacuate: {
    en: 'Evacuate the area',
    es: 'Evacue el Ã¡rea',
    fr: 'Ã‰vacuez la zone'
  },
  stayIndoors: {
    en: 'Stay indoors',
    es: 'Permanezca en el interior',
    fr: 'Restez Ã  l\'intÃ©rieur'
  },
  avoidArea: {
    en: 'Avoid the area',
    es: 'Evite el Ã¡rea',
    fr: 'Ã‰vitez la zone'
  },
  followAuthorities: {
    en: 'Follow authorities\' instructions',
    es: 'Siga las instrucciones de las autoridades',
    fr: 'Suivez les instructions des autoritÃ©s'
  },
  call911: {
    en: 'Call 911 for emergencies',
    es: 'Llame al 911 para emergencias',
    fr: 'Appelez le 911 pour les urgences'
  },
  priority: {
    en: 'Priority',
    es: 'Prioridad',
    fr: 'PrioritÃ©'
  },
  urgent: {
    en: 'Urgent',
    es: 'Urgente',
    fr: 'Urgent'
  },
  normal: {
    en: 'Normal',
    es: 'Normal',
    fr: 'Normal'
  },
  agency: {
    en: 'Agency',
    es: 'Agencia',
    fr: 'Agence'
  },
  source: {
    en: 'Source',
    es: 'Fuente',
    fr: 'Source'
  },
  population: {
    en: 'Affected Population',
    es: 'PoblaciÃ³n Afectada',
    fr: 'Population touchÃ©e'
  }
};

/**
 * Translate a single text value
 */
export function translate(key: string, language: Language, category: 'type' | 'severity' | 'phrase' = 'phrase'): string {
  let translationMap: Record<string, TranslatedAlert>;
  
  switch (category) {
    case 'type':
      translationMap = alertTypeTranslations;
      break;
    case 'severity':
      translationMap = severityTranslations;
      break;
    case 'phrase':
      translationMap = alertPhrases;
      break;
  }
  
  return translationMap[key]?.[language] || key;
}

/**
 * Auto-translate alert message using simple keyword replacement
 */
export function translateAlertMessage(message: string, language: Language): string {
  if (language === 'en') return message;
  
  // Common emergency keywords to translate
  const keywordMap: Record<Language, Record<string, string>> = {
    en: {},
    es: {
      'immediately': 'inmediatamente',
      'emergency': 'emergencia',
      'danger': 'peligro',
      'warning': 'advertencia',
      'alert': 'alerta',
      'evacuate': 'evacuar',
      'shelter': 'refugio',
      'stay': 'permanecer',
      'avoid': 'evitar',
      'area': 'Ã¡rea',
      'please': 'por favor',
      'call': 'llamar',
      'contact': 'contactar',
      'authorities': 'autoridades',
      'police': 'policÃ­a',
      'fire': 'incendio',
      'medical': 'mÃ©dico',
      'rescue': 'rescate',
      'help': 'ayuda',
      'safe': 'seguro',
      'location': 'ubicaciÃ³n',
      'report': 'reportar',
      'severe': 'severo',
      'extreme': 'extremo',
      'critical': 'crÃ­tico'
    },
    fr: {
      'immediately': 'immÃ©diatement',
      'emergency': 'urgence',
      'danger': 'danger',
      'warning': 'avertissement',
      'alert': 'alerte',
      'evacuate': 'Ã©vacuer',
      'shelter': 'abri',
      'stay': 'rester',
      'avoid': 'Ã©viter',
      'area': 'zone',
      'please': 's\'il vous plaÃ®t',
      'call': 'appeler',
      'contact': 'contacter',
      'authorities': 'autoritÃ©s',
      'police': 'police',
      'fire': 'incendie',
      'medical': 'mÃ©dical',
      'rescue': 'sauvetage',
      'help': 'aide',
      'safe': 'sÃ»r',
      'location': 'emplacement',
      'report': 'signaler',
      'severe': 'grave',
      'extreme': 'extrÃªme',
      'critical': 'critique'
    }
  };
  
  let translated = message;
  const keywords = keywordMap[language];
  
  if (keywords) {
    Object.entries(keywords).forEach(([en, foreign]) => {
      const regex = new RegExp(`\\b${en}\\b`, 'gi');
      translated = translated.replace(regex, foreign);
    });
  }
  
  return translated;
}

/**
 * Get language name
 */
export function getLanguageName(language: Language): string {
  const names: Record<Language, string> = {
    en: 'English',
    es: 'EspaÃ±ol',
    fr: 'FranÃ§ais'
  };
  return names[language];
}

/**
 * Get language flag emoji
 */
export function getLanguageFlag(language: Language): string {
  const flags: Record<Language, string> = {
    en: 'ðŸ‡ºðŸ‡¸',
    es: 'ðŸ‡ªðŸ‡¸',
    fr: 'ðŸ‡«ðŸ‡·'
  };
  return flags[language];
}

/**
 * Store user's preferred language
 */
export function setPreferredLanguage(language: Language): void {
  if (typeof window !== 'undefined') {
    localStorage.setItem('preferred_language', language);
  }
}

/**
 * Get user's preferred language
 */
export function getPreferredLanguage(): Language {
  if (typeof window !== 'undefined') {
    const stored = localStorage.getItem('preferred_language');
    if (stored === 'es' || stored === 'fr' || stored === 'en') {
      return stored;
    }
  }
  return 'en';
}=== File: src/lib/types.ts ===
// Core types for Crisis Management Dashboard

export type SeverityLevel = 'critical' | 'high' | 'medium' | 'low';
export type IncidentStatus = 'active' | 'responding' | 'resolved';
export type ResponderStatus = 'active' | 'standby' | 'unavailable';
export type ResponderType = 'Fire' | 'Police' | 'Medical' | 'EMS';
export type AlertType = 'earthquake' | 'flood' | 'fire' | 'hurricane' | 'tornado' | 'amber' | 'silver' | 'other';
export type AlertSeverity = 'extreme' | 'severe' | 'moderate' | 'minor';
export type ResourceStatus = 'available' | 'en-route' | 'on-scene' | 'standby' | 'active';

// Coordinates interface
export interface Coordinates {
  lat: number;
  lng: number;
}

// Ambulance Type (from your actual code)
export interface AmbulanceType {
  id: string;
  status: 'available' | 'en-route' | 'on-scene';
  location: string;
  lastUpdate: string;
  coords?: Coordinates;
  vehicleId?: string;
  medicalEquipment?: string[];
  paramedics?: number;
  patientCapacity?: number;
}

// Hospital Type (from your actual code)
export interface HospitalType {
  id: string;
  name: string;
  capacity: number;
  available: number;
  emergencyWait: string;
  coords?: Coordinates;
  specialties?: string[];
  distance?: string;
  status?: 'operational' | 'limited' | 'full';
}

// First Responder Type (from your actual code)
export interface FirstResponderType {
  id: string;
  name: string;
  type: 'Fire' | 'Police';
  status: 'active' | 'standby';
  location: string;
  coords?: { lat: number; lng: number };
  assignedIncident?: string;
  eta?: string;
  lastUpdate?: string;
}

// Timeline Event Type (from your actual code)
export interface TimelineEventType {
  id: number;
  time: string;
  event: string;
  type: 'alert' | 'dispatch' | 'complete' | 'update';
}

// Communication Type (from your actual code)
export interface CommunicationType {
  id: number;
  from: string;
  to: string;
  message: string;
  time: string;
  timestamp?: number;
  priority?: 'high' | 'normal' | 'low';
  read?: boolean;
}

// Dashboard Data Type (from your actual code)
export interface DashboardData {
  ambulances: AmbulanceType[];
  hospitals: HospitalType[];
  firstResponders: FirstResponderType[];
  timeline: TimelineEventType[];
  communications: CommunicationType[];
}

// Incident interface
export interface Incident {
  id: string;
  title: string;
  type: string;
  severity: SeverityLevel;
  status: IncidentStatus;
  location: string;
  coords: Coordinates;
  time: string;
  description?: string;
  assignedUnits?: string[];
  reportedBy?: string;
  estimatedResolution?: string;
}

// Resource data for charts
export interface ResourceChartData {
  name: string;
  value: number;
  status: ResourceStatus;
  available?: number;
  deployed?: number;
  total?: number;
}

// Government Alert (from AlertSystem component)
export interface GovernmentAlert {
  id: number;
  timestamp: string;
  message: string;
  priority: 'normal' | 'urgent';
  agency: string;
  type?: AlertType;
  severity?: AlertSeverity;
  area?: string;
  expires?: string;
  issued?: string;
  source?: string;
  instructions?: string;
  coords?: Coordinates;
  affectedPopulation?: number;
}

// Real-time update for websocket
export interface RealtimeUpdate {
  type: 'incident' | 'responder' | 'hospital' | 'alert' | 'ambulance' | 'communication';
  action: 'create' | 'update' | 'delete';
  data: Incident | FirstResponderType | HospitalType | GovernmentAlert | AmbulanceType | CommunicationType;
  timestamp: number;
}

// Dashboard metrics
export interface DashboardMetrics {
  activeIncidents: number;
  resolvedIncidents: number;
  activeResponders: number;
  availableBeds: number;
  criticalAlerts: number;
  averageResponseTime: string;
}

// Filter options for incidents
export interface IncidentFilters {
  severity?: SeverityLevel[];
  status?: IncidentStatus[];
  type?: string[];
  dateRange?: {
    start: Date;
    end: Date;
  };
  location?: string;
}

// User/Operator information
export interface Operator {
  id: string;
  name: string;
  role: 'dispatcher' | 'supervisor' | 'admin';
  station: string;
  status: 'online' | 'offline' | 'busy';
  lastActivity?: string;
}

// Notification
export interface Notification {
  id: string;
  type: 'info' | 'warning' | 'error' | 'success';
  title: string;
  message: string;
  timestamp: number;
  read: boolean;
  actionUrl?: string;
}

// API Response wrapper
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  timestamp: number;
}

// Pagination
export interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  pageSize: number;
  hasMore: boolean;
}

// GeoLocation interface (used in responder pages)
export interface GeoLocation {
  lat: number | null;
  lng: number | null;
}

// Responder API Update
export interface ResponderUpdate {
  id: string;
  status: 'standby' | 'active';
  location: { lat: number; lng: number } | null;
  updatedAt: string;
}=== File: src/services/communicationService.ts ===
import { CommunicationType } from '@/lib/types';
import { Socket } from 'socket.io-client';

class CommunicationService {
  private socket: Socket | null = null;
  private messages: CommunicationType[] = [];

  setSocket(socket: Socket) {
    this.socket = socket;
  }

  sendMessage(from: string, to: string, message: string) {
    if (!this.socket) {
      console.error('Socket not initialized');
      return;
    }

    const newMessage: CommunicationType = {
      id: Date.now(),
      from,
      to,
      message,
      time: new Date().toLocaleTimeString()
    };

    this.socket.emit('send:message', newMessage);
    this.messages.unshift(newMessage);

    return newMessage;
  }

  receiveMessage(message: CommunicationType) {
    this.messages.unshift(message);
  }

  getMessages() {
    return this.messages;
  }

  getMessagesByUnit(unitId: string) {
    return this.messages.filter(
      msg => msg.from === unitId || msg.to === unitId
    );
  }

  clearMessages() {
    this.messages = [];
  }
}

export const communicationService = new CommunicationService();=== File: src/services/eventLogger.ts ===
